import{_ as t,r as l,o as p,c as i,a as s,b as e,d as a,e as o}from"./app-FOR18dDf.js";const r={},c=s("h1",{id:"cmu-11751-18781-fall-2022-espnet-tutorial2-new-task",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#cmu-11751-18781-fall-2022-espnet-tutorial2-new-task"},[s("span",null,"CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task)")])],-1),d={href:"https://github.com/espnet/espnet",target:"_blank",rel:"noopener noreferrer"},h=s("p",null,"Main references:",-1),u={href:"https://github.com/espnet/espnet",target:"_blank",rel:"noopener noreferrer"},v={href:"https://espnet.github.io/espnet/",target:"_blank",rel:"noopener noreferrer"},y={href:"https://colab.research.google.com/github/espnet/notebook/blob/master/espnet2_tutorial_2021_CMU_11751_18781.ipynb",target:"_blank",rel:"noopener noreferrer"},m={href:"https://colab.research.google.com/drive/1tY6PxF_M5Nx5n488x0DrpujJOyqW-ATi?usp=sharing",target:"_blank",rel:"noopener noreferrer"},D={href:"https://colab.research.google.com/drive/1d3yMY3xv_hpr2mznskZpF2Cj-bEooDv-?usp=sharing",target:"_blank",rel:"noopener noreferrer"},b=o(`<p>Author: Jiatong Shi (jiatongs@andrew.cmu.edu)</p><p>We would like to thank You (Neil) Zhang for kindly helping the hands-on tutorial and sharing his knowledge on the task.</p><h2 id="‚ùóimportant-notes‚ùó" tabindex="-1"><a class="header-anchor" href="#‚ùóimportant-notes‚ùó"><span>‚ùóImportant Notes‚ùó</span></a></h2><ul><li>We are using Colab to show the demo. However, Colab has some constraints on the total GPU runtime. If you use too much GPU time, you may not be able to use GPU for some time.</li><li>There are multiple in-class checkpoints ‚úÖ throughout this tutorial. There will also be some after-class excersices üìó after the tutorial. <strong>Your participation points are based on these tasks.</strong> Please try your best to follow all the steps! If you encounter issues, please notify the TAs as soon as possible so that we can make an adjustment for you.</li><li>Please submit PDF files of your completed notebooks to Gradescope. You can print the notebook using <code>File -&gt; Print</code> in the menu bar.</li><li>This tutorial covers some advanced usage of ESPnet, which is the extension of the first tutorial.</li></ul><h2 id="useful-links" tabindex="-1"><a class="header-anchor" href="#useful-links"><span>Useful links</span></a></h2><ul><li>Installation https://espnet.github.io/espnet/installation.html</li><li>Usage https://espnet.github.io/espnet/espnet2_tutorial.html</li><li>Reference of task class in ESPnet https://espnet.github.io/espnet/espnet2_task.html</li></ul><h2 id="objectives" tabindex="-1"><a class="header-anchor" href="#objectives"><span>Objectives</span></a></h2><p>After this tutorial, you are expected to know:</p><ul><li>How to add new task in ESPnet2</li><li>How to add new models in ESPnet2</li><li>How to create a new recipe (and template) of a new task from scratch</li></ul><h2 id="function-to-print-date-and-time" tabindex="-1"><a class="header-anchor" href="#function-to-print-date-and-time"><span>Function to print date and time</span></a></h2><p>We first define a function to print the current date and time, which will be used in multiple places below.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#569CD6;">def</span><span style="color:#DCDCAA;"> print_date_and_time</span><span style="color:#D4D4D4;">():</span></span>
<span class="line"><span style="color:#C586C0;">  from</span><span style="color:#D4D4D4;"> datetime </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> datetime</span></span>
<span class="line"><span style="color:#C586C0;">  import</span><span style="color:#D4D4D4;"> pytz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">  now = datetime.now(pytz.timezone(</span><span style="color:#CE9178;">&quot;America/New_York&quot;</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#DCDCAA;">  print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;=&quot;</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#DCDCAA;">  print</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&#39; Current date and time: </span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">now.strftime(</span><span style="color:#CE9178;">&quot;%m/</span><span style="color:#569CD6;">%d</span><span style="color:#CE9178;">/%Y %H:%M:%S&quot;</span><span style="color:#D4D4D4;">)</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#DCDCAA;">  print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;=&quot;</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">60</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># example output</span></span>
<span class="line"><span style="color:#D4D4D4;">print_date_and_time()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="install-espnet-almost-same-procedure-as-your-first-tutorial" tabindex="-1"><a class="header-anchor" href="#install-espnet-almost-same-procedure-as-your-first-tutorial"><span>Install ESPnet (Almost same procedure as your first tutorial)</span></a></h1><h2 id="download-espnet" tabindex="-1"><a class="header-anchor" href="#download-espnet"><span>Download ESPnet</span></a></h2><p>We use <code>git clone</code> to download the source code of ESPnet and then go to a specific commit.</p><p><strong>Important:</strong> In other versions of ESPnet, you may encounter errors related to imcompatible package versions (<code>numba</code>). Please use the same commit to avoid such issues.</p><p>Note that we are using another branch <code>espnet_tutorial_asvspoof</code> instead of &quot;master&quot;. You can also use your own fork to proceed the following sections if you want to use Github to save your code.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It takes a few seconds</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">git clone </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">depth </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;"> -b </span><span style="color:#F44747;">2022fall_new_task_tutorial</span><span style="color:#D4D4D4;"> https://github.com/espnet/espnet</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># We use a specific commit just for reproducibility.</span></span>
<span class="line"><span style="color:#D4D4D4;">%cd /content/espnet</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">git checkout </span><span style="color:#F44747;">9cff98a78ceaa4d85843be0a50b369ec826b27f6</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="setup-python-environment-based-on-anaconda-install-espnet" tabindex="-1"><a class="header-anchor" href="#setup-python-environment-based-on-anaconda-install-espnet"><span>Setup Python environment based on anaconda + Install ESPnet</span></a></h2><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It takes 30 seconds</span></span>
<span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/tools</span></span>
<span class="line"><span style="color:#D4D4D4;">!./setup_anaconda.sh anaconda espnet </span><span style="color:#B5CEA8;">3.9</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># It may take 12 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/tools</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">make TH_VERSION=</span><span style="color:#B5CEA8;">1.12</span><span style="color:#D4D4D4;">.1 CUDA_VERSION=</span><span style="color:#B5CEA8;">11.6</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="what-we-provide-you-and-what-you-need-to-proceed" tabindex="-1"><a class="header-anchor" href="#what-we-provide-you-and-what-you-need-to-proceed"><span>What we provide you and what you need to proceed</span></a></h1><p>We have provide you most of the files needed for ASVSpoof recipe. So you do not need to add any additional files. However, noted that some of the files are not complete and need your completion to proceed. For a quick overview of the whole layout of the new task, please refer to https://github.com/espnet/espnet/compare/master...2022fall_new_task_tutorial</p><p>As elaborated in the warming-up, we have shown that there are two core components for a new task in ESPnet: a <strong>task library</strong> and correponding <strong>recipe setups</strong>. For the following of the section, we will briefly show the overall layout of adding the ASVSpoof task in ESPnet. The listed files are almost the minimum requirements to add a new task in ESPnet.</p><p><strong>Task library for ASVSpoof</strong></p><p>Followings are a list of files adding to ESPnet for ASVSpoof (files in &quot;&quot; are ones that need modifications)</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>- espnet2</span></span>
<span class="line"><span>  - bin</span></span>
<span class="line"><span>    - asvspoof_train.py # Major entry point for asvspoof</span></span>
<span class="line"><span>    - &quot;asvspoof_inference.py&quot; (Checkpoint 4) # Inference scripts for asvspoof</span></span>
<span class="line"><span>  - asvspoof</span></span>
<span class="line"><span>    - decoder</span></span>
<span class="line"><span>      - __init__.py</span></span>
<span class="line"><span>      - abs_decoder.py # abstract class for decoder in ASVSpoof</span></span>
<span class="line"><span>      - &quot;linear_decoder.py&quot; (Checkpoint 3) # simple linear decoder for ASVSpoof</span></span>
<span class="line"><span>    - loss</span></span>
<span class="line"><span>      - __init__.py</span></span>
<span class="line"><span>      - abs_loss.py # abstract class for loss in ASVSpoof</span></span>
<span class="line"><span>      - binary_loss.py # naive binary class loss for ASVSpoof</span></span>
<span class="line"><span>      - am_softmax.py</span></span>
<span class="line"><span>      - &quot;oc_softmax.py&quot; (Bouns)</span></span>
<span class="line"><span>    - __init__.py</span></span>
<span class="line"><span>    - &quot;espnet_model.py&quot; (Bouns)</span></span>
<span class="line"><span>  - tasks</span></span>
<span class="line"><span>    - &quot;asvspoof.py&quot; (Checkpoint 2)</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To help you understand more, we would recommend you to check the layout of other tasks (e.g., ASR, TTS, ST, etc.) to understand how the codebase is functioning.</p><p><strong>Recipe for ASVSpoof</strong></p><p>Followings are a list of files adding to ESPnet for ASVSpoof (files in boldface are ones that need modifications)</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>- egs2</span></span>
<span class="line"><span>  - TEMPLATE</span></span>
<span class="line"><span>    - asvspoof1</span></span>
<span class="line"><span>      - &quot;asvspoof.sh&quot; (Checkpoint 1)</span></span>
<span class="line"><span>      - others</span></span>
<span class="line"><span>  - espnet_tutorial</span></span>
<span class="line"><span>    - asvspoof11</span></span>
<span class="line"><span>      - conf</span></span>
<span class="line"><span>      - &quot;asvspoof.sh‚Äù (Checkpoint 1)</span></span>
<span class="line"><span>      - local</span></span>
<span class="line"><span>        - &quot;data_prep.py&quot; (Bouns)</span></span>
<span class="line"><span>        - &quot;data.sh&quot; (Bouns)</span></span>
<span class="line"><span>      - &quot;run.sh&quot; (Checkpoint 5)</span></span>
<span class="line"><span>      - scripts</span></span>
<span class="line"><span>      - pyscripts</span></span>
<span class="line"><span>      - utils</span></span>
<span class="line"><span>      - steps</span></span>
<span class="line"><span>      - path.sh</span></span>
<span class="line"><span>      - db.sh</span></span>
<span class="line"><span>      - cmd.sh</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,30),f={href:"https://www.freecodecamp.org/news/symlink-tutorial-in-linux-how-to-create-and-remove-a-symbolic-link/",target:"_blank",rel:"noopener noreferrer"},g=s("code",null,"asvspoof.sh",-1),_=o(`<h2 id="asvspoof-data-preparation" tabindex="-1"><a class="header-anchor" href="#asvspoof-data-preparation"><span>ASVSpoof data preparation</span></a></h2><p>As discussed in the warm-up session, ASVSpoof aims to conduct a binary classfication. As the task layout is a bit different from the ASR task we touched on the first tutorial, so we need to use a different format to formulate the data. For here, to keep the simplicity, we stil use the exact same file as the first tutorial:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>wav.scp text utt2spk spk2utt</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>But on the other hand, we change the format of text into</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>utt_id1 0</span></span>
<span class="line"><span>utt_id2 1</span></span>
<span class="line"><span>utt_id3 0</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>where 0 represents real speech and 1 stands for fake speech.</p><h3 id="download-dataset" tabindex="-1"><a class="header-anchor" href="#download-dataset"><span>Download dataset</span></a></h3><p>We first download the data from google drive. Noted that the data is a subset of the ASVSpoof2019 Challenge.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># a few seconds</span></span>
<span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/egs2/espnet_tutorial/asvspoof1/</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">gdown </span><span style="color:#F44747;">1HRdjjmGXBTXOqOq9iijuXPCA4y_46OzP</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">unzip espnet_tutorial_asvspoof.zip</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="prepare-data-stage1-stage2" tabindex="-1"><a class="header-anchor" href="#prepare-data-stage1-stage2"><span>Prepare data (Stage1 &amp; Stage2)</span></a></h3><p>This time, we make the task template to be as simple as possible. The data preparation will be only two stages, including basic data preparation and wave format.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It may take around 6 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asvspoof.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">1</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">2</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;eval&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="asvspoof-collect-stats-‚úÖ-checkpint-1-1-point" tabindex="-1"><a class="header-anchor" href="#asvspoof-collect-stats-‚úÖ-checkpint-1-1-point"><span>ASVSpoof collect stats (‚úÖ Checkpint 1 (1 point))</span></a></h3><p>Similar to the previous tutorial, we collect the statisitcs for the data.</p><p>In the process, the data will be passed into a iterable loader. However, remember that the <code>text</code> file is no longer the format as the ASR recipe. Therefore, we will need to use another data loader to load the corresponding information.</p>`,15),k={href:"https://github.com/espnet/espnet/blob/a7bd6522b32ec6472c13f6a2289dcdff4a846c12/espnet2/train/dataset.py#L130-L249",target:"_blank",rel:"noopener noreferrer"},w=s("code",null,"[REPLACE_ME]",-1),E=s("code",null,"asvspoof.sh",-1),x=o(`<p>After the replacement, you should be able to run the following blocks</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It takes less than 2 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asvspoof.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">3</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">3</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;dev eval&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asvspoof_config conf/checkpoint1_dummy.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">NOTE</span><span style="color:#6A9955;">: Checkpoint 1</span></span>
<span class="line"><span style="color:#D4D4D4;">print_date_and_time()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="asvspoof-model" tabindex="-1"><a class="header-anchor" href="#asvspoof-model"><span>ASVSpoof Model</span></a></h2><p>In this section, we will define the ASVSpoof model and use the model to conduct the training of ASVSpoof task. For easier understanding, we first use an <code>encoder</code> to convert speech features into hidden representations and then use a <code>decoder</code> to conduct the classification.</p><h3 id="encoder-‚úÖ-checkpint-2-1-point" tabindex="-1"><a class="header-anchor" href="#encoder-‚úÖ-checkpint-2-1-point"><span>Encoder (‚úÖ Checkpint 2 (1 point))</span></a></h3>`,5),A={href:"https://arxiv.org/abs/2010.13956",target:"_blank",rel:"noopener noreferrer"},C=o(`<p>Code-reusibility is one of the major benefits of using ESPnet as a toolkit for speech tasks. As ESPnet already support conformer block in ASR, it is easy to import into this new task.</p><p>In ESPnet, adding modules that we already have can be as simple as two-line codes. Please add lines into <code>/content/espnet/espnet2/tasks/asvspoof.py</code>. We have marked <code>TODO</code> in the scripts for your convenience.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It takes less than 2 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asvspoof.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">3</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">3</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;dev eval&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asvspoof_config conf/checkpoint2.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">NOTE</span><span style="color:#6A9955;">: Checkpoint 2</span></span>
<span class="line"><span style="color:#D4D4D4;">print_date_and_time()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="decoder-‚úÖ-checkpint-3-1-point" tabindex="-1"><a class="header-anchor" href="#decoder-‚úÖ-checkpint-3-1-point"><span>Decoder (‚úÖ Checkpint 3 (1 point))</span></a></h3><p>In this stage, we will finally start the training. As the previous tutorial, we can use the Tensorboard to monitor the process.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># Load the TensorBoard notebook extension</span></span>
<span class="line"><span style="color:#D4D4D4;">%reload_ext tensorboard</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Launch tensorboard before training</span></span>
<span class="line"><span style="color:#D4D4D4;">%tensorboard </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">logdir /content/espnet/egs2/espnet_tutorial/asvspoof1/exp</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After we finished the encoder, we also need to create a decoder to conduct the prediciton. As the encoder will generate hidden representations, we want to have a simple decoder to conduct mean-pooling to all the hidden representation at the time-axis. There should be another linear layer to conclude the models into binary classification. Please fill the missing part in <code>/conent/espnet/espnet2/asvspoof/decoder/linear_decoder.py</code> to finally start the training. For people who are not familiar with Pytorch, please refer the related resources for details.</p><p>Related resources that could be helpful for this checkpoint:</p><ul><li>https://pytorch.org/docs/stable/generated/torch.mean.html</li><li>https://pytorch.org/docs/stable/generated/torch.nn.Linear.html</li><li>https://pytorch.org/tutorials/beginner/basics/buildmodel_tutorial.html</li></ul><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">nvidia-smi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># Training takes around 2 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asvspoof.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">4</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">4</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;dev eval&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asvspoof_config conf/checkpoint2.yaml </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">inference_config conf/decode_asvspoof.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">NOTE</span><span style="color:#6A9955;">: Checkpoint 3</span></span>
<span class="line"><span style="color:#D4D4D4;">print_date_and_time()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="model-inference" tabindex="-1"><a class="header-anchor" href="#model-inference"><span>Model Inference</span></a></h2><h3 id="‚úÖ-checkpint-4-1-point" tabindex="-1"><a class="header-anchor" href="#‚úÖ-checkpint-4-1-point"><span>(‚úÖ Checkpint 4 (1 point))</span></a></h3>`,12),S={href:"https://www.igi-global.com/dictionary/equal-error-rate-eer/35389",target:"_blank",rel:"noopener noreferrer"},F=o(`<p>Please fill the missing parts with <code>TODO</code>s in <code>/content/espnet/espnet2/bin/asvspoof_inference.py</code></p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">!./asvspoof.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">5</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">5</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;eval&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asvspoof_config conf/checkpoint2.yaml </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">inference_nj </span><span style="color:#B5CEA8;">1</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">gpu_inference true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">NOTE</span><span style="color:#6A9955;">: Checkpoint 4</span></span>
<span class="line"><span style="color:#D4D4D4;">print_date_and_time()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="scoring" tabindex="-1"><a class="header-anchor" href="#scoring"><span>Scoring</span></a></h2><h3 id="‚úÖ-checkpint-5-1-point" tabindex="-1"><a class="header-anchor" href="#‚úÖ-checkpint-5-1-point"><span>(‚úÖ Checkpint 5 (1 point))</span></a></h3><p>We have prepred the scoring script for you. We can get the EER by the following code-block</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">!./asvspoof.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">6</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">6</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;eval&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asvspoof_config conf/checkpoint2.yaml </span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">chmod +x scripts/utils/show_asvspoof_result.sh</span></span>
<span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">NOTE</span><span style="color:#6A9955;">: Checkpoint 5</span></span>
<span class="line"><span style="color:#D4D4D4;">print_date_and_time()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="üìó-exercise-1-1-point-bonus" tabindex="-1"><a class="header-anchor" href="#üìó-exercise-1-1-point-bonus"><span>üìó Exercise 1 (1 point bonus)</span></a></h2><p>In the data you just downloaded, we have some extra data for training (<code>/content/espnet/egs2/espnet_tutorial/asvspoof1/espnet_asvspoof_tutorial/extend_train</code>). Please try to combine them with the training set and then conduct experiments the augmented set. You are also encouraged to change the model configuration. <strong>If you achieve a better equal error rate (EER) than the previous experiments, you can get a bonus point.</strong></p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">TODO</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">NOTE</span><span style="color:#6A9955;">: Exercise 1</span></span>
<span class="line"><span style="color:#D4D4D4;">print_date_and_time()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="üìó-exercise-2-1-point-bonus" tabindex="-1"><a class="header-anchor" href="#üìó-exercise-2-1-point-bonus"><span>üìó Exercise 2 (1 point bonus)</span></a></h2>`,10),q={href:"https://arxiv.org/pdf/2010.13995.pdf",target:"_blank",rel:"noopener noreferrer"},P=o(`<p>We have implemented the AM softmax method located in <code>/content/espnet/espnet2/asvspoof/loss/am_softmax_loss.py</code> and also prepared the template <code>/content/espnet/espnet2/asvspoof/loss/oc_softmax_loss.py</code> for your implementation. You can follow the TODOs to implement the methods (note that the inference/train_config should change accordingly).</p><p><strong>If you successfully implement the OC-softmax and get similar/better EER, you can get a bouns point</strong></p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">TODO</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">NOTE</span><span style="color:#6A9955;">: Exercise 2</span></span>
<span class="line"><span style="color:#D4D4D4;">print_date_and_time()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3);function T(I,B){const n=l("ExternalLinkIcon");return p(),i("div",null,[c,s("p",null,[s("a",d,[e("ESPnet"),a(n)]),e(" is a widely-used end-to-end speech processing toolkit. It has supported various speech processing tasks. ESPnet uses PyTorch as a main deep learning engine, and also follows Kaldi style data processing, feature extraction/format, and recipes to provide a complete setup for speech recognition and other speech processing experiments.")]),h,s("ul",null,[s("li",null,[s("a",u,[e("ESPnet repository"),a(n)])]),s("li",null,[s("a",v,[e("ESPnet documentation"),a(n)])]),s("li",null,[s("a",y,[e("ESPnet tutorial in Speech Recognition and Understanding (Fall 2021)"),a(n)])]),s("li",null,[s("a",m,[e("Recitation in Multilingual NLP (Spring 2022)"),a(n)])]),s("li",null,[s("a",D,[e("ESPnet tutorial1 in Speech Recognition and Understanding (Fall 2022)"),a(n)])])]),b,s("p",null,[e("Noted that because of the "),s("a",f,[e("symlink"),a(n)]),e(", the "),g,e(" is essentially the same for checkpoint 1.")]),_,s("p",null,[e("Fortunately, we have a wide range of data loaders for choices, which is listing in "),s("a",k,[e("here"),a(n)]),e(". Please choose the correct file format and replace the "),w,e(" token in "),E]),x,s("p",null,[e("First, we are going to focus on the encoder part. There has been a long history over the discussion of the speech encoder in our community. Given the sequential perspective, people firstly investigated recurrent neural networks. More recently, we are focusing on "),s("a",A,[e("conformer block"),a(n)]),e(", which is an extension to the transformer block. In the previous settings, we used a transformer block to collect stats. However, we would want to switch to conformer.")]),C,s("p",null,[e("As the training is finished, we expect to conduct ASVSpoof on the test set. To approach that, we first have to finish the inference codebase. For our task specifically, we need the log-probability of the prediction to compute "),s("a",S,[e("equal error rate (EER)"),a(n)]),e(". Therefore the output should be a float number for each utterance.")]),F,s("p",null,[e("One main issue of speech anti-spoofing research is the generalization to unseen attacks, i.e., synthesis methods not seen in training the anti-spoofing models. In fact, the test set in our scenario is exact in the same case. Recently, there is a "),s("a",q,[e("one-class learning method"),a(n)]),e(" that compacts the natural speech representations and separate them from the fake speech with a certain margin in the embedding space.")]),P])}const V=t(r,[["render",T],["__file","espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.html.vue"]]);export{V as default};
