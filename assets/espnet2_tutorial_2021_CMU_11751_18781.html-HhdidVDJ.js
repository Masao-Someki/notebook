import{_ as o,r as p,o as t,c as i,a as s,b as n,d as e,e as l}from"./app-FOR18dDf.js";const r={},c=s("h1",{id:"cmu-11751-18781-2021-espnet-tutorial",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#cmu-11751-18781-2021-espnet-tutorial"},[s("span",null,"CMU 11751/18781 2021: ESPnet Tutorial")])],-1),d=s("p",null,"ESPnet is an end-to-end speech processing toolkit, initially focused on end-to-end speech recognition and end-to-end text-to-speech, but now extended to various other speech processing. ESPnet uses PyTorch as a main deep learning engine, and also follows Kaldi style data processing, feature extraction/format, and recipes to provide a complete setup for speech recognition and other speech processing experiments.",-1),D=s("p",null,"This tutorial is based on the collection of espnet notebook demos https://github.com/espnet/notebook, espnet documentations in https://espnet.github.io/espnet/, and README.md in https://github.com/espnet/espnet",-1),u={href:"https://github.com/sw005320",target:"_blank",rel:"noopener noreferrer"},y=s("h2",{id:"useful-links",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#useful-links"},[s("span",null,"Useful links")])],-1),v=s("ul",null,[s("li",null,"Installation https://espnet.github.io/espnet/installation.html"),s("li",null,"Usage https://espnet.github.io/espnet/espnet2_tutorial.html")],-1),m=s("h1",{id:"run-an-inference-example",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#run-an-inference-example"},[s("span",null,"Run an inference example")])],-1),h=s("li",null,[s("p",null,"ESPnet covers various speech applications and their pre-trained models.")],-1),b={href:"https://github.com/espnet/espnet_model_zoo/blob/master/espnet_model_zoo/table.csv",target:"_blank",rel:"noopener noreferrer"},_=s("li",null,[s("p",null,"We can play with a demo based on these pre-trained models.")],-1),g=s("li",null,[s("p",null,[n("What we only need is to install "),s("code",null,"espnet_model_zoo")])],-1),C=s("li",null,[s("p",null,[n("Note that this "),s("code",null,"pip"),n(" based installation does not include training and so on. The full installation is explained later.")])],-1),E=s("li",null,[s("p",null,"You can also find similar demos in HuggingFace Hub https://huggingface.co/espnet")],-1),f=l(`<div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It takes 1 minute.</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">pip install -q espnet_model_zoo</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="speech-recognition-demo" tabindex="-1"><a class="header-anchor" href="#speech-recognition-demo"><span>Speech recognition demo</span></a></h2>`,2),k={href:"https://github.com/ftshijt",target:"_blank",rel:"noopener noreferrer"},q=s("h3",{id:"model-selection",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#model-selection"},[s("span",null,"Model Selection")])],-1),x={href:"https://github.com/espnet/espnet_model_zoo/blob/master/espnet_model_zoo/table.csv",target:"_blank",rel:"noopener noreferrer"},A=s("li",null,[s("p",null,"They are stored in zenodo https://zenodo.org/communities/espnet or HuggingFace Hub https://huggingface.co/espnet")],-1),w=s("li",null,[s("p",null,"In this demonstration, we will show English, Japanese, Spanish, Mandrain, and Multilingual ASR models, respectively")],-1),F=l(`<div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">#@title Choose English ASR model { run: &quot;auto&quot; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">lang = </span><span style="color:#CE9178;">&#39;en&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">fs = </span><span style="color:#B5CEA8;">16000</span><span style="color:#6A9955;"> #@param {type:&quot;integer&quot;}</span></span>
<span class="line"><span style="color:#D4D4D4;">tag = </span><span style="color:#CE9178;">&#39;Shinji Watanabe/spgispeech_asr_train_asr_conformer6_n_fft512_hop_length256_raw_en_unnorm_bpe5000_valid.acc.ave&#39;</span><span style="color:#6A9955;"> #@param [&quot;Shinji Watanabe/spgispeech_asr_train_asr_conformer6_n_fft512_hop_length256_raw_en_unnorm_bpe5000_valid.acc.ave&quot;, &quot;kamo-naoyuki/librispeech_asr_train_asr_conformer6_n_fft512_hop_length256_raw_en_bpe5000_scheduler_confwarmup_steps40000_optim_conflr0.0025_sp_valid.acc.ave&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">#@title Choose Japanese ASR model { run: &quot;auto&quot; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">lang = </span><span style="color:#CE9178;">&#39;ja&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">fs = </span><span style="color:#B5CEA8;">16000</span><span style="color:#6A9955;"> #@param {type:&quot;integer&quot;}</span></span>
<span class="line"><span style="color:#D4D4D4;">tag = </span><span style="color:#CE9178;">&#39;Shinji Watanabe/laborotv_asr_train_asr_conformer2_latest33_raw_char_sp_valid.acc.ave&#39;</span><span style="color:#6A9955;"> #@param [&quot;Shinji Watanabe/laborotv_asr_train_asr_conformer2_latest33_raw_char_sp_valid.acc.ave&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">#@title Choose Spanish ASR model { run: &quot;auto&quot; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">lang = </span><span style="color:#CE9178;">&#39;es&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">fs = </span><span style="color:#B5CEA8;">16000</span><span style="color:#6A9955;"> #@param {type:&quot;integer&quot;}</span></span>
<span class="line"><span style="color:#D4D4D4;">tag = </span><span style="color:#CE9178;">&#39;ftshijt/mls_asr_transformer_valid.acc.best&#39;</span><span style="color:#6A9955;"> #@param [&quot;ftshijt/mls_asr_transformer_valid.acc.best&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">#@title Choose Mandrain ASR model { run: &quot;auto&quot; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">lang = </span><span style="color:#CE9178;">&#39;zh&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">fs = </span><span style="color:#B5CEA8;">16000</span><span style="color:#6A9955;"> #@param {type:&quot;integer&quot;}</span></span>
<span class="line"><span style="color:#D4D4D4;">tag = </span><span style="color:#CE9178;">&#39;Emiru Tsunoo/aishell_asr_train_asr_streaming_transformer_raw_zh_char_sp_valid.acc.ave&#39;</span><span style="color:#6A9955;"> #@param [&quot;	Emiru Tsunoo/aishell_asr_train_asr_streaming_transformer_raw_zh_char_sp_valid.acc.ave&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">#@title Choose Multilingual ASR model { run: &quot;auto&quot; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">lang = </span><span style="color:#CE9178;">&#39;multilingual&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">fs = </span><span style="color:#B5CEA8;">16000</span><span style="color:#6A9955;"> #@param {type:&quot;integer&quot;}</span></span>
<span class="line"><span style="color:#D4D4D4;">tag = </span><span style="color:#CE9178;">&#39;ftshijt/open_li52_asr_train_asr_raw_bpe7000_valid.acc.ave_10best&#39;</span><span style="color:#6A9955;"> #@param [&quot;	ftshijt/open_li52_asr_train_asr_raw_bpe7000_valid.acc.ave_10best&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="model-setup" tabindex="-1"><a class="header-anchor" href="#model-setup"><span>Model Setup</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> time</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> torch</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> string</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> espnet_model_zoo.downloader </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> ModelDownloader</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> espnet2.bin.asr_inference </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> Speech2Text</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">d = ModelDownloader()</span></span>
<span class="line"><span style="color:#6A9955;"># It may takes a while to download and build models</span></span>
<span class="line"><span style="color:#D4D4D4;">speech2text = Speech2Text(</span></span>
<span class="line"><span style="color:#D4D4D4;">    **d.download_and_unpack(tag),</span></span>
<span class="line"><span style="color:#9CDCFE;">    device</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;cuda&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    minlenratio</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    maxlenratio</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    ctc_weight</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.3</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    beam_size</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    batch_size</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    nbest</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#DCDCAA;"> text_normalizer</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">text</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">    text = text.upper()</span></span>
<span class="line"><span style="color:#C586C0;">    return</span><span style="color:#D4D4D4;"> text.translate(</span><span style="color:#4EC9B0;">str</span><span style="color:#D4D4D4;">.maketrans(</span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;&#39;</span><span style="color:#D4D4D4;">, string.punctuation))</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="recognize-our-examples-of-pre-recorded-samples" tabindex="-1"><a class="header-anchor" href="#recognize-our-examples-of-pre-recorded-samples"><span>Recognize our examples of pre-recorded samples</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">git clone https://github.com/ftshijt/ESPNet_asr_egs.git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> pandas </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> pd</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> soundfile</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> librosa.display</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> IPython.display </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> display, Audio</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> matplotlib.pyplot </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> plt</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">egs = pd.read_csv(</span><span style="color:#CE9178;">&quot;ESPNet_asr_egs/egs.csv&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> index, row </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> egs.iterrows():</span></span>
<span class="line"><span style="color:#C586C0;">  if</span><span style="color:#D4D4D4;"> row[</span><span style="color:#CE9178;">&quot;lang&quot;</span><span style="color:#D4D4D4;">] == lang </span><span style="color:#569CD6;">or</span><span style="color:#D4D4D4;"> lang == </span><span style="color:#CE9178;">&quot;multilingual&quot;</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">    speech, rate = soundfile.read(</span><span style="color:#CE9178;">&quot;ESPNet_asr_egs/&quot;</span><span style="color:#D4D4D4;"> + row[</span><span style="color:#CE9178;">&quot;path&quot;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#C586C0;">    assert</span><span style="color:#D4D4D4;"> fs == </span><span style="color:#4EC9B0;">int</span><span style="color:#D4D4D4;">(row[</span><span style="color:#CE9178;">&quot;sr&quot;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#D4D4D4;">    nbests = speech2text(speech)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    text, *_ = nbests[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#DCDCAA;">    print</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;Input Speech: ESPNet_asr_egs/</span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">row[</span><span style="color:#CE9178;">&#39;path&#39;</span><span style="color:#D4D4D4;">]</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#6A9955;">    # let us listen to samples</span></span>
<span class="line"><span style="color:#D4D4D4;">    display(Audio(speech, </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=rate))</span></span>
<span class="line"><span style="color:#D4D4D4;">    librosa.display.waveplot(speech, </span><span style="color:#9CDCFE;">sr</span><span style="color:#D4D4D4;">=rate)</span></span>
<span class="line"><span style="color:#D4D4D4;">    plt.show()</span></span>
<span class="line"><span style="color:#DCDCAA;">    print</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;Reference text: </span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">text_normalizer(row[</span><span style="color:#CE9178;">&#39;text&#39;</span><span style="color:#D4D4D4;">])</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#DCDCAA;">    print</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;ASR hypothesis: </span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">text_normalizer(text)</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#DCDCAA;">    print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;*&quot;</span><span style="color:#D4D4D4;"> * </span><span style="color:#B5CEA8;">50</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="recognize-your-own-live-recordings" tabindex="-1"><a class="header-anchor" href="#recognize-your-own-live-recordings"><span>Recognize your own live-recordings</span></a></h3><ol><li>Record your own voice</li><li>Recognize your voice with the ASR system</li></ol><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># from https://gist.github.com/korakot/c21c3476c024ad6d56d5f48b0bca92be</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> IPython.display </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> Javascript</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> google.colab </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> output</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> base64 </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> b64decode</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">RECORD = </span><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#CE9178;">const sleep = time =&gt; new Promise(resolve =&gt; setTimeout(resolve, time))</span></span>
<span class="line"><span style="color:#CE9178;">const b2text = blob =&gt; new Promise(resolve =&gt; {</span></span>
<span class="line"><span style="color:#CE9178;">  const reader = new FileReader()</span></span>
<span class="line"><span style="color:#CE9178;">  reader.onloadend = e =&gt; resolve(e.srcElement.result)</span></span>
<span class="line"><span style="color:#CE9178;">  reader.readAsDataURL(blob)</span></span>
<span class="line"><span style="color:#CE9178;">})</span></span>
<span class="line"><span style="color:#CE9178;">var record = time =&gt; new Promise(async resolve =&gt; {</span></span>
<span class="line"><span style="color:#CE9178;">  stream = await navigator.mediaDevices.getUserMedia({ audio: true })</span></span>
<span class="line"><span style="color:#CE9178;">  recorder = new MediaRecorder(stream)</span></span>
<span class="line"><span style="color:#CE9178;">  chunks = []</span></span>
<span class="line"><span style="color:#CE9178;">  recorder.ondataavailable = e =&gt; chunks.push(e.data)</span></span>
<span class="line"><span style="color:#CE9178;">  recorder.start()</span></span>
<span class="line"><span style="color:#CE9178;">  await sleep(time)</span></span>
<span class="line"><span style="color:#CE9178;">  recorder.onstop = async ()=&gt;{</span></span>
<span class="line"><span style="color:#CE9178;">    blob = new Blob(chunks)</span></span>
<span class="line"><span style="color:#CE9178;">    text = await b2text(blob)</span></span>
<span class="line"><span style="color:#CE9178;">    resolve(text)</span></span>
<span class="line"><span style="color:#CE9178;">  }</span></span>
<span class="line"><span style="color:#CE9178;">  recorder.stop()</span></span>
<span class="line"><span style="color:#CE9178;">})</span></span>
<span class="line"><span style="color:#CE9178;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">def</span><span style="color:#DCDCAA;"> record</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">sec</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">filename</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;audio.wav&#39;</span><span style="color:#D4D4D4;">):</span></span>
<span class="line"><span style="color:#D4D4D4;">  display(Javascript(RECORD))</span></span>
<span class="line"><span style="color:#D4D4D4;">  s = output.eval_js(</span><span style="color:#CE9178;">&#39;record(</span><span style="color:#569CD6;">%d</span><span style="color:#CE9178;">)&#39;</span><span style="color:#D4D4D4;"> % (sec * </span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">  b = b64decode(s.split(</span><span style="color:#CE9178;">&#39;,&#39;</span><span style="color:#D4D4D4;">)[</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#C586C0;">  with</span><span style="color:#DCDCAA;"> open</span><span style="color:#D4D4D4;">(filename, </span><span style="color:#CE9178;">&#39;wb+&#39;</span><span style="color:#D4D4D4;">) </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> f:</span></span>
<span class="line"><span style="color:#D4D4D4;">    f.write(b)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">audio = </span><span style="color:#CE9178;">&#39;audio.wav&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">second = </span><span style="color:#B5CEA8;">5</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;Speak to your microphone </span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">second</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;"> sec...&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">record(second, audio)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Done!&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> librosa</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> librosa.display</span></span>
<span class="line"><span style="color:#D4D4D4;">speech, rate = librosa.load(audio, </span><span style="color:#9CDCFE;">sr</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">16000</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">librosa.display.waveplot(speech, </span><span style="color:#9CDCFE;">sr</span><span style="color:#D4D4D4;">=rate)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> matplotlib.pyplot </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> plt</span></span>
<span class="line"><span style="color:#D4D4D4;">plt.show()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> pysndfile</span></span>
<span class="line"><span style="color:#D4D4D4;">pysndfile.sndio.write(</span><span style="color:#CE9178;">&#39;audio_ds.wav&#39;</span><span style="color:#D4D4D4;">, speech, </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=rate, </span><span style="color:#9CDCFE;">format</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;wav&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">enc</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&#39;pcm16&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> IPython.display </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> display, Audio</span></span>
<span class="line"><span style="color:#D4D4D4;">display(Audio(speech, </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=rate))</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">nbests = speech2text(speech)</span></span>
<span class="line"><span style="color:#D4D4D4;">text, *_ = nbests[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;ASR hypothesis: </span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">text_normalizer(text)</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="speech-synthesis-demo" tabindex="-1"><a class="header-anchor" href="#speech-synthesis-demo"><span>Speech synthesis demo</span></a></h2><p>This notebook provides a demonstration of the realtime E2E-TTS using ESPnet2-TTS and ParallelWaveGAN repo.</p><ul><li>ESPnet2-TTS: https://github.com/espnet/espnet/tree/master/egs2/TEMPLATE/tts1</li><li>ParallelWaveGAN: https://github.com/kan-bayashi/ParallelWaveGAN</li></ul>`,16),S={href:"https://github.com/kan-bayashi",target:"_blank",rel:"noopener noreferrer"},T=l(`<h3 id="installation" tabindex="-1"><a class="header-anchor" href="#installation"><span>Installation</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># </span><span style="color:#569CD6;">NOTE</span><span style="color:#6A9955;">: pip shows imcompatible errors due to preinstalled libraries but you do not need to care</span></span>
<span class="line"><span style="color:#6A9955;"># It takes 1 minute</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">pip install -q pyopenjtalk==</span><span style="color:#B5CEA8;">0.1</span><span style="color:#D4D4D4;">.5 parallel_wavegan==</span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">.3 </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="model-selection-1" tabindex="-1"><a class="header-anchor" href="#model-selection-1"><span>Model Selection</span></a></h3><p>Please select model: English, Japanese, and Mandarin are supported.</p><p>You can try end-to-end text2wav model &amp; combination of text2mel and vocoder.<br> If you use text2wav model, you do not need to use vocoder (automatically disabled).</p><p><strong>Text2wav models</strong>:</p><ul><li>VITS</li></ul><p><strong>Text2mel models</strong>:</p><ul><li>Tacotron2</li><li>Transformer-TTS</li><li>(Conformer) FastSpeech</li><li>(Conformer) FastSpeech2</li></ul><p><strong>Vocoders</strong>:</p><ul><li>Parallel WaveGAN</li><li>Multi-band MelGAN</li><li>HiFiGAN</li><li>Style MelGAN.</li></ul><blockquote><p>The terms of use follow that of each corpus. We use the following corpora:</p></blockquote><ul><li><code>ljspeech_*</code>: LJSpeech dataset <ul><li>https://keithito.com/LJ-Speech-Dataset/</li></ul></li><li><code>jsut_*</code>: JSUT corpus <ul><li>https://sites.google.com/site/shinnosuketakamichi/publication/jsut</li></ul></li><li><code>jvs_*</code>: JVS corpus + JSUT corpus <ul><li>https://sites.google.com/site/shinnosuketakamichi/research-topics/jvs_corpus</li><li>https://sites.google.com/site/shinnosuketakamichi/publication/jsut</li></ul></li><li><code>tsukuyomi_*</code>: つくよみちゃんコーパス + JSUT corpus <ul><li>https://tyc.rei-yumesaki.net/material/corpus/</li><li>https://sites.google.com/site/shinnosuketakamichi/publication/jsut</li></ul></li><li><code>csmsc_*</code>: Chinese Standard Mandarin Speech Corpus <ul><li>https://www.data-baker.com/open_source.html</li></ul></li></ul><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">#@title Choose English model { run: &quot;auto&quot; }</span></span>
<span class="line"><span style="color:#D4D4D4;">lang = </span><span style="color:#CE9178;">&#39;English&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">tag = </span><span style="color:#CE9178;">&#39;kan-bayashi/ljspeech_vits&#39;</span><span style="color:#6A9955;"> #@param [&quot;kan-bayashi/ljspeech_tacotron2&quot;, &quot;kan-bayashi/ljspeech_fastspeech&quot;, &quot;kan-bayashi/ljspeech_fastspeech2&quot;, &quot;kan-bayashi/ljspeech_conformer_fastspeech2&quot;, &quot;kan-bayashi/ljspeech_vits&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"><span style="color:#D4D4D4;">vocoder_tag = </span><span style="color:#CE9178;">&quot;none&quot;</span><span style="color:#6A9955;"> #@param [&quot;none&quot;, &quot;parallel_wavegan/ljspeech_parallel_wavegan.v1&quot;, &quot;parallel_wavegan/ljspeech_full_band_melgan.v2&quot;, &quot;parallel_wavegan/ljspeech_multi_band_melgan.v2&quot;, &quot;parallel_wavegan/ljspeech_hifigan.v1&quot;, &quot;parallel_wavegan/ljspeech_style_melgan.v1&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">#@title Choose Japanese model { run: &quot;auto&quot; }</span></span>
<span class="line"><span style="color:#D4D4D4;">lang = </span><span style="color:#CE9178;">&#39;Japanese&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">tag = </span><span style="color:#CE9178;">&#39;kan-bayashi/jsut_full_band_vits_prosody&#39;</span><span style="color:#6A9955;"> #@param [&quot;kan-bayashi/jsut_tacotron2&quot;, &quot;kan-bayashi/jsut_transformer&quot;, &quot;kan-bayashi/jsut_fastspeech&quot;, &quot;kan-bayashi/jsut_fastspeech2&quot;, &quot;kan-bayashi/jsut_conformer_fastspeech2&quot;, &quot;kan-bayashi/jsut_conformer_fastspeech2_accent&quot;, &quot;kan-bayashi/jsut_conformer_fastspeech2_accent_with_pause&quot;, &quot;kan-bayashi/jsut_vits_accent_with_pause&quot;, &quot;kan-bayashi/jsut_full_band_vits_accent_with_pause&quot;, &quot;kan-bayashi/jsut_tacotron2_prosody&quot;, &quot;kan-bayashi/jsut_transformer_prosody&quot;, &quot;kan-bayashi/jsut_conformer_fastspeech2_tacotron2_prosody&quot;, &quot;kan-bayashi/jsut_vits_prosody&quot;, &quot;kan-bayashi/jsut_full_band_vits_prosody&quot;, &quot;kan-bayashi/jvs_jvs010_vits_prosody&quot;, &quot;kan-bayashi/tsukuyomi_full_band_vits_prosody&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"><span style="color:#D4D4D4;">vocoder_tag = </span><span style="color:#CE9178;">&#39;none&#39;</span><span style="color:#6A9955;"> #@param [&quot;none&quot;, &quot;parallel_wavegan/jsut_parallel_wavegan.v1&quot;, &quot;parallel_wavegan/jsut_multi_band_melgan.v2&quot;, &quot;parallel_wavegan/jsut_style_melgan.v1&quot;, &quot;parallel_wavegan/jsut_hifigan.v1&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">#@title Choose Mandarin model { run: &quot;auto&quot; }</span></span>
<span class="line"><span style="color:#D4D4D4;">lang = </span><span style="color:#CE9178;">&#39;Mandarin&#39;</span></span>
<span class="line"><span style="color:#D4D4D4;">tag = </span><span style="color:#CE9178;">&#39;kan-bayashi/csmsc_full_band_vits&#39;</span><span style="color:#6A9955;"> #@param [&quot;kan-bayashi/csmsc_tacotron2&quot;, &quot;kan-bayashi/csmsc_transformer&quot;, &quot;kan-bayashi/csmsc_fastspeech&quot;, &quot;kan-bayashi/csmsc_fastspeech2&quot;, &quot;kan-bayashi/csmsc_conformer_fastspeech2&quot;, &quot;kan-bayashi/csmsc_vits&quot;, &quot;kan-bayashi/csmsc_full_band_vits&quot;] {type: &quot;string&quot;}</span></span>
<span class="line"><span style="color:#D4D4D4;">vocoder_tag = </span><span style="color:#CE9178;">&quot;none&quot;</span><span style="color:#6A9955;"> #@param [&quot;none&quot;, &quot;parallel_wavegan/csmsc_parallel_wavegan.v1&quot;, &quot;parallel_wavegan/csmsc_multi_band_melgan.v2&quot;, &quot;parallel_wavegan/csmsc_hifigan.v1&quot;, &quot;parallel_wavegan/csmsc_style_melgan.v1&quot;] {type:&quot;string&quot;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="model-setup-1" tabindex="-1"><a class="header-anchor" href="#model-setup-1"><span>Model Setup</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> espnet2.bin.tts_inference </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> Text2Speech</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> espnet2.utils.types </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> str_or_none</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">text2speech = Text2Speech.from_pretrained(</span></span>
<span class="line"><span style="color:#9CDCFE;">    model_tag</span><span style="color:#D4D4D4;">=str_or_none(tag),</span></span>
<span class="line"><span style="color:#9CDCFE;">    vocoder_tag</span><span style="color:#D4D4D4;">=str_or_none(vocoder_tag),</span></span>
<span class="line"><span style="color:#9CDCFE;">    device</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;cuda&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#6A9955;">    # Only for Tacotron 2 &amp; Transformer</span></span>
<span class="line"><span style="color:#9CDCFE;">    threshold</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.5</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#6A9955;">    # Only for Tacotron 2</span></span>
<span class="line"><span style="color:#9CDCFE;">    minlenratio</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    maxlenratio</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">10.0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    use_att_constraint</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    backward_window</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    forward_window</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">3</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#6A9955;">    # Only for FastSpeech &amp; FastSpeech2 &amp; VITS</span></span>
<span class="line"><span style="color:#9CDCFE;">    speed_control_alpha</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">1.0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#6A9955;">    # Only for VITS</span></span>
<span class="line"><span style="color:#9CDCFE;">    noise_scale</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.667</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">    noise_scale_dur</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.8</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="synthesis" tabindex="-1"><a class="header-anchor" href="#synthesis"><span>Synthesis</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> time</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> torch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># decide the input sentence by yourself</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;Input your favorite sentence in </span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">lang</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">.&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">x = </span><span style="color:#DCDCAA;">input</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># synthesis</span></span>
<span class="line"><span style="color:#C586C0;">with</span><span style="color:#D4D4D4;"> torch.no_grad():</span></span>
<span class="line"><span style="color:#D4D4D4;">    start = time.time()</span></span>
<span class="line"><span style="color:#D4D4D4;">    wav = text2speech(x)[</span><span style="color:#CE9178;">&quot;wav&quot;</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">rtf = (time.time() - start) / (</span><span style="color:#DCDCAA;">len</span><span style="color:#D4D4D4;">(wav) / text2speech.fs)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;RTF = </span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">rtf</span><span style="color:#569CD6;">:5f}</span><span style="color:#CE9178;">&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># let us listen to generated samples</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> IPython.display </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> display, Audio</span></span>
<span class="line"><span style="color:#D4D4D4;">display(Audio(wav.view(-</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">).cpu().numpy(), </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=text2speech.fs))</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="speech-enhancement-demo" tabindex="-1"><a class="header-anchor" href="#speech-enhancement-demo"><span>Speech enhancement demo</span></a></h2><ul><li>ESPnet2-SE: https://github.com/espnet/espnet/tree/master/egs2/TEMPLATE/enh1</li></ul>`,22),j={href:"https://github.com/LiChenda",target:"_blank",rel:"noopener noreferrer"},B={href:"https://github.com/Emrys365",target:"_blank",rel:"noopener noreferrer"},z=l(`<h3 id="single-channel-enhancement-the-chime-example" tabindex="-1"><a class="header-anchor" href="#single-channel-enhancement-the-chime-example"><span>Single-Channel Enhancement, the CHiME example</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># Download one utterance from real noisy speech of CHiME4</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">gdown </span><span style="color:#F44747;">--</span><span style="color:#DCDCAA;">id</span><span style="color:#F44747;"> 1SmrN5NFSg6JuQSs2sfy3ehD8OIcqK6wS</span><span style="color:#D4D4D4;"> -O /content/M05_440C0213_PED_REAL.wav</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> soundfile</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> IPython.display </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> display, Audio</span></span>
<span class="line"><span style="color:#D4D4D4;">mixwav_mc, sr = soundfile.read(</span><span style="color:#CE9178;">&quot;/content/M05_440C0213_PED_REAL.wav&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#6A9955;"># mixwav.shape: num_samples, num_channels</span></span>
<span class="line"><span style="color:#D4D4D4;">mixwav_sc = mixwav_mc[:,</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">display(Audio(mixwav_mc.T, </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=sr))</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="download-and-load-the-pretrained-conv-tasnet" tabindex="-1"><a class="header-anchor" href="#download-and-load-the-pretrained-conv-tasnet"><span>Download and load the pretrained Conv-Tasnet</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">gdown </span><span style="color:#F44747;">--</span><span style="color:#DCDCAA;">id</span><span style="color:#F44747;"> 17DMWdw84wF3fz3t7ia1zssdzhkpVQGZm</span><span style="color:#D4D4D4;"> -O /content/chime_tasnet_singlechannel.zip</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">unzip /content/chime_tasnet_singlechannel.zip -d /content/enh_model_sc</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># Load the model</span></span>
<span class="line"><span style="color:#6A9955;"># If you encounter error &quot;No module named &#39;espnet2&#39;&quot;, please re-run the 1st Cell. This might be a colab bug.</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> sys</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> soundfile</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> espnet2.bin.enh_inference </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> SeparateSpeech</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">separate_speech = {}</span></span>
<span class="line"><span style="color:#6A9955;"># For models downloaded from GoogleDrive, you can use the following script:</span></span>
<span class="line"><span style="color:#D4D4D4;">enh_model_sc = SeparateSpeech(</span></span>
<span class="line"><span style="color:#9CDCFE;">  train_config</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;/content/enh_model_sc/exp/enh_train_enh_conv_tasnet_raw/config.yaml&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  model_file</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;/content/enh_model_sc/exp/enh_train_enh_conv_tasnet_raw/5epoch.pth&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#6A9955;">  # for segment-wise process on long speech</span></span>
<span class="line"><span style="color:#9CDCFE;">  normalize_segment_scale</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  show_progressbar</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  ref_channel</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  normalize_output_wav</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  device</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;cuda:0&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="enhance-the-single-channel-real-noisy-speech-in-chime4" tabindex="-1"><a class="header-anchor" href="#enhance-the-single-channel-real-noisy-speech-in-chime4"><span>Enhance the single-channel real noisy speech in CHiME4</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># play the enhanced single-channel speech</span></span>
<span class="line"><span style="color:#D4D4D4;">wave = enh_model_sc(mixwav_sc[</span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">, ...], sr)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Input real noisy speech&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">flush</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">display(Audio(mixwav_sc, </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=sr))</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Enhanced speech&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">flush</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">display(Audio(wave[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].squeeze(), </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=sr))</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="speech-separation" tabindex="-1"><a class="header-anchor" href="#speech-separation"><span>Speech Separation</span></a></h3><h4 id="model-selection-2" tabindex="-1"><a class="header-anchor" href="#model-selection-2"><span>Model Selection</span></a></h4>`,9),P={href:"https://github.com/espnet/espnet_model_zoo/blob/master/espnet_model_zoo/table.csv",target:"_blank",rel:"noopener noreferrer"},I=l(`<p>In this demonstration, we will show different speech separation models on wsj0_2mix.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;">#@title Choose Speech Separation model { run: &quot;auto&quot; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">fs = </span><span style="color:#B5CEA8;">8000</span><span style="color:#6A9955;"> #@param {type:&quot;integer&quot;}</span></span>
<span class="line"><span style="color:#D4D4D4;">tag = </span><span style="color:#CE9178;">&quot;Chenda Li/wsj0_2mix_enh_train_enh_conv_tasnet_raw_valid.si_snr.ave&quot;</span><span style="color:#6A9955;"> #@param [&quot;Chenda Li/wsj0_2mix_enh_train_enh_conv_tasnet_raw_valid.si_snr.ave&quot;, &quot;Chenda Li/wsj0_2mix_enh_train_enh_rnn_tf_raw_valid.si_snr.ave&quot;, &quot;https://zenodo.org/record/4688000/files/enh_train_enh_dprnn_tasnet_raw_valid.si_snr.ave.zip&quot;]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># For models uploaded to Zenodo, you can use the following python script instead:</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> sys</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> soundfile</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> espnet_model_zoo.downloader </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> ModelDownloader</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> espnet2.bin.enh_inference </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> SeparateSpeech</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">d = ModelDownloader()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">cfg = d.download_and_unpack(tag)</span></span>
<span class="line"><span style="color:#D4D4D4;">separate_speech = SeparateSpeech(</span></span>
<span class="line"><span style="color:#9CDCFE;">  train_config</span><span style="color:#D4D4D4;">=cfg[</span><span style="color:#CE9178;">&quot;train_config&quot;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#9CDCFE;">  model_file</span><span style="color:#D4D4D4;">=cfg[</span><span style="color:#CE9178;">&quot;model_file&quot;</span><span style="color:#D4D4D4;">],</span></span>
<span class="line"><span style="color:#6A9955;">  # for segment-wise process on long speech</span></span>
<span class="line"><span style="color:#9CDCFE;">  segment_size</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">2.4</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  hop_size</span><span style="color:#D4D4D4;">=</span><span style="color:#B5CEA8;">0.8</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  normalize_segment_scale</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  show_progressbar</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  ref_channel</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  normalize_output_wav</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;">  device</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;cuda:0&quot;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="separate-the-example-in-wsj0-2mix-testing-set" tabindex="-1"><a class="header-anchor" href="#separate-the-example-in-wsj0-2mix-testing-set"><span>Separate the example in wsj0_2mix testing set</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">gdown </span><span style="color:#F44747;">--</span><span style="color:#DCDCAA;">id</span><span style="color:#F44747;"> 1ZCUkd_Lb7pO2rpPr4FqYdtJBZ7JMiInx</span><span style="color:#D4D4D4;"> -O /content/</span><span style="color:#F44747;">447c020t_1</span><span style="color:#D4D4D4;">.2106_422a0112_-</span><span style="color:#B5CEA8;">1.2106</span><span style="color:#D4D4D4;">.wav</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> os</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> soundfile</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> IPython.display </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> display, Audio</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">mixwav, sr = soundfile.read(</span><span style="color:#CE9178;">&quot;/content/447c020t_1.2106_422a0112_-1.2106.wav&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">waves_wsj = separate_speech(mixwav[</span><span style="color:#569CD6;">None</span><span style="color:#D4D4D4;">, ...], </span><span style="color:#9CDCFE;">fs</span><span style="color:#D4D4D4;">=sr)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Input mixture&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">flush</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">display(Audio(mixwav, </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=sr))</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">f</span><span style="color:#CE9178;">&quot;========= Separated speech with model </span><span style="color:#569CD6;">{</span><span style="color:#D4D4D4;">tag</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;"> =========&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">flush</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Separated spk1&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">flush</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">display(Audio(waves_wsj[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">].squeeze(), </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=sr))</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Separated spk2&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">flush</span><span style="color:#D4D4D4;">=</span><span style="color:#569CD6;">True</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">display(Audio(waves_wsj[</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">].squeeze(), </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=sr))</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="full-installation" tabindex="-1"><a class="header-anchor" href="#full-installation"><span>Full installation</span></a></h1>`,6),M=s("li",null,[s("p",null,"This is a full installation method to perform data preprocess, training, inference, scoring, and so on. for various experiments.")],-1),R={href:"https://github.com/espnet/espnet/blob/master/docker/README.md",target:"_blank",rel:"noopener noreferrer"},N=s("li",null,[s("p",null,"See https://espnet.github.io/espnet/installation.html#step-2-installation-espnet for more details.")],-1),W=l(`<p><strong>Installation of required tools</strong></p><p>See https://espnet.github.io/espnet/installation.html#requirements for more details.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It takes ~10 seconds</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">sudo apt-get install cmake sox libsndfile1-dev</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Download espnet</strong></p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It takes a few seconds</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">git clone </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">depth </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;"> https://github.com/espnet/espnet</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Setup Python environment based on anaconda</strong></p><p>There are several other installation methods, but <strong>we highly recommend the anaconda-based one</strong>.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It takes 30 seconds</span></span>
<span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/tools</span></span>
<span class="line"><span style="color:#D4D4D4;">!./setup_anaconda.sh anaconda espnet </span><span style="color:#B5CEA8;">3.8</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Install espnet</strong></p><p>This includes the installation of PyTorch and other tools.</p><p>We just specify CUDA_VERSION=10.2 for the latest PyTorch (1.9.0)</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It may take ~8 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/tools</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">make CUDA_VERSION=</span><span style="color:#B5CEA8;">10.2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Install other speech processing tools</strong></p><p>We install NIST SCTK toolkit for scoring</p><p>Please manually install other tools if needed.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/tools</span></span>
<span class="line"><span style="color:#D4D4D4;">!./installers/install_sctk.sh</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Check installation</strong></p><p>Please check whether torch, torch cuda, and espnet are correctly installed.</p><p>If torch, torch cuda, and espnet are successfully installed, it would be no problem.</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>[x] torch=1.9.0</span></span>
<span class="line"><span>[x] torch cuda=10.2</span></span>
<span class="line"><span>:</span></span>
<span class="line"><span>[x] espnet=0.10.3a3</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/tools</span></span>
<span class="line"><span style="color:#D4D4D4;">!. ./activate_python.sh; python3 check_install.py</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="run-a-recipe-example" tabindex="-1"><a class="header-anchor" href="#run-a-recipe-example"><span>Run a recipe example</span></a></h1><p>ESPnet has a number of recipes (73 recipes on Sep. 16, 2021). Let&#39;s first check https://github.com/espnet/espnet/blob/master/egs2/README.md</p><p>Please also check the general usage of the recipe in https://espnet.github.io/espnet/espnet2_tutorial.html#recipes-using-espnet2</p><p><strong>CMU AN4 recipe</strong></p><p>In this tutorial, we use the CMU an4 recipe. This is a small-scale speech recognition task mainly used for testing.</p><p>First, move to the recipe directory</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/egs2/an4/asr1</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">ls</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>egs2/an4/asr1/</span></span>
<span class="line"><span> - conf/      # Configuration files for training, inference, etc.</span></span>
<span class="line"><span> - scripts/   # Bash utilities of espnet2</span></span>
<span class="line"><span> - pyscripts/ # Python utilities of espnet2</span></span>
<span class="line"><span> - steps/     # From Kaldi utilities</span></span>
<span class="line"><span> - utils/     # From Kaldi utilities</span></span>
<span class="line"><span> - db.sh      # The directory path of each corpora</span></span>
<span class="line"><span> - path.sh    # Setup script for environment variables</span></span>
<span class="line"><span> - cmd.sh     # Configuration for your backend of job scheduler</span></span>
<span class="line"><span> - run.sh     # Entry point</span></span>
<span class="line"><span> - asr.sh     # Invoked by run.sh</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ESPnet is designed for various use cases (local machines or cluster machines) based on Kaldi tools. If you use it in the cluster machines, please also check https://kaldi-asr.org/doc/queue.html</p><p>The main stages can be parallelized by various jobs.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cat run.sh</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>run.sh</code> can call <code>asr.sh</code>, which completes the entire speech recognition experiments, including data preparation, training, inference, and scoring. They are based on separate stages (totally 15 stages).</p><p>Instead of executing the entire experiments by <code>run.sh</code>, the following example executes the experiment for each stage to understand the process in each stage.</p><h2 id="data-preparation" tabindex="-1"><a class="header-anchor" href="#data-preparation"><span>data preparation</span></a></h2><p><strong>Stage 1: Data preparation for training, validation, and evaluation data</strong></p><p>Note that <code>--stage &lt;N&gt;</code> is to start the stage and <code>--stop_stage &lt;N&gt;</code> is to stop the stage. We also need to specify training, validation, and test data.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># 30 seconds</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">1</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">1</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train_nodev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set train_dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;train_dev test&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>After this stage is finished, please check the <code>data</code> directory</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">ls data</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>In this recipe, we use <code>train_nodev</code> as a training set, <code>train_dev</code> as a validation set (monitor the training progress by checking the validation score). We also use (reuse) <code>test</code> and <code>train_dev</code> sets for the final speech recognition evaluation.</p><p>Let&#39;s check one of the training data directory:</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">ls -</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;"> data/train_nodev/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>These are the speech and corresponding text and speaker information based on the Kaldi format. Please also check https://kaldi-asr.org/doc/data_prep.html</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>spk2utt # Speaker information</span></span>
<span class="line"><span>text    # Transcription file</span></span>
<span class="line"><span>utt2spk # Speaker information</span></span>
<span class="line"><span>wav.scp # Audio file</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Stage 2: Speed perturbation</strong> (one of the data augmentation methods)</p><p>We do not use speed perturbation for this demo. But you can turn it on by adding an argument <code>--speed_perturb_factors &quot;0.9 1.0 1.1&quot;</code> to the shell script</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">2</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">2</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train_nodev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set train_dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;train_dev test&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Stage 3: Format wav.scp: data/ -&gt; dump/raw</strong></p><p>We dump the data with specified format (flac in this case) for the efficient use of the data.</p><p>Note that <code>--nj &lt;N&gt;</code> means the number of CPU jobs. Please set it appropriately by considering your CPU resources and disk access.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># 30 seconds</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">3</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">3</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train_nodev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set train_dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;train_dev test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">nj </span><span style="color:#B5CEA8;">4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Stage 4: Remove long/short data: dump/raw/org -&gt; dump/raw</strong></p><p>There are too long and too short audio data, which are harmful for our efficient training. Those data are removed from the list.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">4</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">4</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train_nodev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set train_dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;train_dev test&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Stage 5: Generate token_list from dump/raw/train_nodev/text using BPE.</strong></p><p>This is important for text processing. We make a dictionary based on the English character in this example. We use a <code>sentencepiece</code> toolkit developed by Google.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">5</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">5</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train_nodev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set train_dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;train_dev test&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Let&#39;s check the content of the dictionary. There are several special symbols, e.g.,</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>&lt;blank&gt;   used for CTC</span></span>
<span class="line"><span>&lt;unk&gt;     unknown symbols do not appear in the training data</span></span>
<span class="line"><span>&lt;sos/eos&gt; start and end sentence symbols</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cat data/token_list/bpe_unigram30/tokens.txt</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="language-modeling-skip-in-this-tutorial" tabindex="-1"><a class="header-anchor" href="#language-modeling-skip-in-this-tutorial"><span>language modeling (skip in this tutorial)</span></a></h2><p><strong>Stages 6--9: Stages related to language modeling.</strong></p><p>We skip the language modeling part in the recipe (stages 6 -- 9) in this tutorial.</p><h2 id="end-to-end-asr" tabindex="-1"><a class="header-anchor" href="#end-to-end-asr"><span>End-to-end ASR</span></a></h2><p><strong>Stage 10: ASR collect stats</strong>: train_set=dump/raw/train_nodev, valid_set=dump/raw/train_dev</p><p>We estimate the mean and variance of the data to normalize the data. We also collect the information of input and output lengths for the efficient mini batch creation.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># 18 seconds</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">10</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">10</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train_nodev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set train_dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;train_dev test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">nj </span><span style="color:#B5CEA8;">4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Stage 11: ASR Training:</strong> train_set=dump/raw/train_nodev, valid_set=dump/raw/train_dev</p><p>Main training loop.</p><p>Please also monitor the following files</p><ul><li>log file /content/espnet/egs2/an4/asr1/exp/asr_train_raw_bpe30/train.log</li><li>loss /content/espnet/egs2/an4/asr1/exp/asr_train_raw_bpe30/images/loss.png</li><li>accuracy /content/espnet/egs2/an4/asr1/exp/asr_train_raw_bpe30/images/acc.png</li></ul><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It would take 20-30 min.</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train_nodev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set train_dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;train_dev test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">ngpu </span><span style="color:#B5CEA8;">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Stage 12</strong>: Decoding: training_dir=exp/asr_train_raw_bpe30</p><p>Note that we need to make <code>--use_lm false</code> since we skip the language model.</p><p><code>inference_nj &lt;N&gt;</code> specifies the number of inference jobs</p><p>Let&#39;s monitor the log /content/espnet/egs2/an4/asr1/exp/asr_train_raw_bpe30/inference_asr_model_valid.acc.ave/train_dev/logdir/asr_inference.1.log</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It would take ~10 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">inference_nj </span><span style="color:#B5CEA8;">4</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">12</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">12</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train_nodev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set train_dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;train_dev test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">use_lm false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Stage 13: Scoring</strong></p><p>You can find word error rate (WER), character error rate (CER), etc. for each test set.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">13</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">13</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train_set train_nodev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">valid_set train_dev </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;train_dev test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">use_lm false</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>You can also check the break down of the word error rate in /content/espnet/egs2/an4/asr1/exp/asr_train_raw_bpe30/inference_asr_model_valid.acc.ave/train_dev/score_wer/result.txt</p><h2 id="how-to-change-the-training-configs" tabindex="-1"><a class="header-anchor" href="#how-to-change-the-training-configs"><span>How to change the training configs?</span></a></h2><h3 id="config-file-based" tabindex="-1"><a class="header-anchor" href="#config-file-based"><span>config file based</span></a></h3><p>All training options are changed by using a config file.</p><p>Pleae check https://espnet.github.io/espnet/espnet2_training_option.html</p><p>Let&#39;s first check config files prepared in the <code>an4</code> recipe</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>- LSTM-based E2E ASR /content/espnet/egs2/an4/asr1/conf/train_asr_rnn.yaml</span></span>
<span class="line"><span>- Transformer based E2E ASR /content/espnet/egs2/an4/asr1/conf/train_asr_transformer.yaml</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>You can run</p><p><strong>RNN</strong></p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>./asr.sh --stage 10 \\</span></span>
<span class="line"><span>   --train_set train_nodev \\    </span></span>
<span class="line"><span>   --valid_set train_dev \\</span></span>
<span class="line"><span>   --test_sets &quot;train_dev test&quot; \\</span></span>
<span class="line"><span>   --nj 4 \\</span></span>
<span class="line"><span>   --inference_nj 4 \\</span></span>
<span class="line"><span>   --use_lm false \\</span></span>
<span class="line"><span>   ----asr_config conf/train_asr_rnn.yaml </span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Transformer</strong></p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>./asr.sh --stage 10 \\</span></span>
<span class="line"><span>   --train_set train_nodev \\    </span></span>
<span class="line"><span>   --valid_set train_dev \\</span></span>
<span class="line"><span>   --test_sets &quot;train_dev test&quot; \\</span></span>
<span class="line"><span>   --nj 4 \\</span></span>
<span class="line"><span>   --inference_nj 4 \\</span></span>
<span class="line"><span>   --use_lm false \\</span></span>
<span class="line"><span>   ----asr_config conf/train_asr_transformer.yaml</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also find various configs in <code>espnet/egs2/*/asr1/conf/</code>, including</p><ul><li>Conformer <code>espnet/egs2/librispeech/asr1/conf/train_asr_confformer.yaml</code></li><li>Wav2vec2.0 pre-trained model and fine-tuning <code>https://github.com/espnet/espnet/blob/master/egs2/librispeech/asr1/conf/tuning/train_asr_conformer7_wav2vec2_960hr_large.yaml</code></li><li>HuBERT pre-trained model and fine-tuning <code>https://github.com/espnet/espnet/blob/master/egs2/librispeech/asr1/conf/tuning/train_asr_conformer7_hubert_960hr_large.yaml</code></li></ul><h3 id="command-line-argument-based" tabindex="-1"><a class="header-anchor" href="#command-line-argument-based"><span>command line argument based</span></a></h3><p>You can also customize it by editing the file or passing the command line arguments, e.g.,</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>./run.sh --stage 10 --asr_args &quot;--model_conf ctc_weight=0.3&quot;</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>./run.sh --stage 10 --asr_args &quot;--optim_conf lr=0.1&quot;</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>See https://espnet.github.io/espnet/espnet2_tutorial.html#change-the-configuration-for-training</p><h2 id="how-to-make-a-new-recipe" tabindex="-1"><a class="header-anchor" href="#how-to-make-a-new-recipe"><span>How to make a new recipe?</span></a></h2><ul><li>Check https://github.com/espnet/espnet/tree/master/egs2/TEMPLATE</li></ul>`,102);function L(J,U){const a=p("ExternalLinkIcon");return t(),i("div",null,[c,d,D,s("p",null,[n("Author: Shinji Watanabe ("),s("a",u,[n("@sw005320"),e(a)]),n(")")]),y,v,m,s("ul",null,[h,s("li",null,[s("p",null,[n("Please check a model shown in "),s("a",b,[n("espnet_model_zoo"),e(a)])])]),_,g,C,E]),f,s("p",null,[n("Author: Jiatong Shi ("),s("a",k,[n("@ftshijt"),e(a)]),n(")")]),q,s("ul",null,[s("li",null,[s("p",null,[n("Please select the model shown in "),s("a",x,[n("espnet_model_zoo"),e(a)]),n(".")])]),A,w]),F,s("p",null,[n("Author: Tomoki Hayashi ("),s("a",S,[n("@kan-bayashi"),e(a)]),n(")")]),T,s("p",null,[n("Author: Chenda Li ("),s("a",j,[n("@LiChenda"),e(a)]),n("), Wangyou Zhang ("),s("a",B,[n("@Emrys365"),e(a)]),n(")")]),z,s("p",null,[n("Please select model shown in "),s("a",P,[n("espnet_model_zoo"),e(a)])]),I,s("ul",null,[M,s("li",null,[s("p",null,[n("We prepare various ways of installations. We also prepare a "),s("a",R,[n("docker image"),e(a)]),n(" as well.")])]),N]),W])}const H=o(r,[["render",L],["__file","espnet2_tutorial_2021_CMU_11751_18781.html.vue"]]);export{H as default};
