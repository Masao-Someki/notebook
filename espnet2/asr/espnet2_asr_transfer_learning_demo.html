<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.2" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <link rel="manifest" href="/manifest.webmanifest"><meta name="application-name" content="Example"><meta name="apple-mobile-web-app-title" content="Example"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileColor" content="#3eaf7c"><meta name="theme-color" content="#3eaf7c"><title>Use transfer learning for ASR in ESPnet2 | ESPnet-Example</title><meta name="description" content="Example notebooks for ESPnet">
    <link rel="preload" href="/notebook/assets/style-cp41dQ25.css" as="style"><link rel="stylesheet" href="/notebook/assets/style-cp41dQ25.css">
    <link rel="modulepreload" href="/notebook/assets/app-FOR18dDf.js"><link rel="modulepreload" href="/notebook/assets/espnet2_asr_transfer_learning_demo.html-IksoduPb.js"><link rel="modulepreload" href="/notebook/assets/espnet2_asr_transfer_learning_demo.html-K8AGvfnJ.js">
    <link rel="prefetch" href="/notebook/assets/index.html-XAvCBsD6.js" as="script"><link rel="prefetch" href="/notebook/assets/DataPreparation_CMU_11492_692_Spring2023(Assignment0).html-KBtpWdkS.js" as="script"><link rel="prefetch" href="/notebook/assets/SpeechEnhancement_CMU_11492_692_Spring2023(Assignment7).html-ojQTonzi.js" as="script"><link rel="prefetch" href="/notebook/assets/SpokenLanguageUnderstanding_CMU_11492_692_Spring2023(Assignment6).html-k7t3PiyY.js" as="script"><link rel="prefetch" href="/notebook/assets/TextToSpeech_CMU_11492_692_Spring2023(Assignment8).html-mugYinQi.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.html-xjN-GwTF.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html-IaNcm8K-.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_tutorial_2021_CMU_11751_18781.html-IMfnLI01.js" as="script"><link rel="prefetch" href="/notebook/assets/asr_cli.html-JH3saHIF.js" as="script"><link rel="prefetch" href="/notebook/assets/asr_library.html-nD4wSonE.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_asr_realtime_demo.html-31qj-nF8.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_streaming_asr_demo.html-NgcmLWnC.js" as="script"><link rel="prefetch" href="/notebook/assets/onnx_conversion_demo.html-wfKipc9w.js" as="script"><link rel="prefetch" href="/notebook/assets/pretrained.html--Y7vPVCq.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet_se_demonstration_for_waspaa_2021.html-_RqduImg.js" as="script"><link rel="prefetch" href="/notebook/assets/se_demo.html-zhHwqNB_.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_2pass_slu_demo.html-SOe7ZUtq.js" as="script"><link rel="prefetch" href="/notebook/assets/st_demo.html-_JBPLyfl.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_tts_realtime_demo.html-9h1FXENI.js" as="script"><link rel="prefetch" href="/notebook/assets/tts_cli.html-OLkBd5Fu.js" as="script"><link rel="prefetch" href="/notebook/assets/tts_realtime_demo.html-Bgn0MtVH.js" as="script"><link rel="prefetch" href="/notebook/assets/finetune_owsm.html-oRbSv_3K.js" as="script"><link rel="prefetch" href="/notebook/assets/finetune_with_lora.html-53DWrWT9.js" as="script"><link rel="prefetch" href="/notebook/assets/train.html-ZtrUU739.js" as="script"><link rel="prefetch" href="/notebook/assets/tacotron2.html-lMDTfHXx.js" as="script"><link rel="prefetch" href="/notebook/assets/404.html-6Yl8cQE3.js" as="script"><link rel="prefetch" href="/notebook/assets/index.html-Fa1mvKNA.js" as="script"><link rel="prefetch" href="/notebook/assets/DataPreparation_CMU_11492_692_Spring2023(Assignment0).html-yZnfE8Rl.js" as="script"><link rel="prefetch" href="/notebook/assets/SpeechEnhancement_CMU_11492_692_Spring2023(Assignment7).html-EtOqTzx1.js" as="script"><link rel="prefetch" href="/notebook/assets/SpokenLanguageUnderstanding_CMU_11492_692_Spring2023(Assignment6).html-3QqySz0B.js" as="script"><link rel="prefetch" href="/notebook/assets/TextToSpeech_CMU_11492_692_Spring2023(Assignment8).html-oKNm4LpP.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.html-4zeeKKut.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html-Xne2M8JW.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_tutorial_2021_CMU_11751_18781.html-HhdidVDJ.js" as="script"><link rel="prefetch" href="/notebook/assets/asr_cli.html-knKjgurg.js" as="script"><link rel="prefetch" href="/notebook/assets/asr_library.html-Kz7KwH4E.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_asr_realtime_demo.html-RYvF9e8R.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_streaming_asr_demo.html-6EF7rYtq.js" as="script"><link rel="prefetch" href="/notebook/assets/onnx_conversion_demo.html-1dXBgI7d.js" as="script"><link rel="prefetch" href="/notebook/assets/pretrained.html-bRY7ZLad.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet_se_demonstration_for_waspaa_2021.html-53aPYjLT.js" as="script"><link rel="prefetch" href="/notebook/assets/se_demo.html-0y7hJZOb.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_2pass_slu_demo.html-LPf_aa6M.js" as="script"><link rel="prefetch" href="/notebook/assets/st_demo.html-GjLoLXxU.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_tts_realtime_demo.html-NCcWLTBY.js" as="script"><link rel="prefetch" href="/notebook/assets/tts_cli.html-Elg6sapX.js" as="script"><link rel="prefetch" href="/notebook/assets/tts_realtime_demo.html-wTutqUQW.js" as="script"><link rel="prefetch" href="/notebook/assets/finetune_owsm.html-BKHMtCfm.js" as="script"><link rel="prefetch" href="/notebook/assets/finetune_with_lora.html-h3VNWfNm.js" as="script"><link rel="prefetch" href="/notebook/assets/train.html-zSf_6N6D.js" as="script"><link rel="prefetch" href="/notebook/assets/tacotron2.html-gzrp5q7X.js" as="script"><link rel="prefetch" href="/notebook/assets/404.html-8hkKDKOa.js" as="script"><link rel="prefetch" href="/notebook/assets/NpmBadge-ZlH3swud.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/notebook/" class=""><img class="logo" src="/notebook/images/espnet_logo1.png" alt="ESPnet-Example"><span class="site-name can-hide" aria-hidden="true">ESPnet-Example</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ESPnet2"><span class="title">ESPnet2</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ESPnet2"><span class="title">ESPnet2</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ASR</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/asr_cli.html" class="" aria-label="Speech Recognition (Recipe)"><!--[--><!--]--> Speech Recognition (Recipe) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/asr_library.html" class="" aria-label="Speech Recognition (Library)"><!--[--><!--]--> Speech Recognition (Library) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_asr_realtime_demo.html" class="" aria-label="ESPnet2-ASR realtime demonstration"><!--[--><!--]--> ESPnet2-ASR realtime demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/notebook/espnet2/asr/espnet2_asr_transfer_learning_demo.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Use transfer learning for ASR in ESPnet2"><!--[--><!--]--> Use transfer learning for ASR in ESPnet2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_streaming_asr_demo.html" class="" aria-label="ESPnet2 real streaming Transformer demonstration"><!--[--><!--]--> ESPnet2 real streaming Transformer demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TTS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/espnet2_tts_realtime_demo.html" class="" aria-label="ESPnet2-TTS realtime demonstration"><!--[--><!--]--> ESPnet2-TTS realtime demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/tts_cli.html" class="" aria-label="Text-to-Speech (Recipe)"><!--[--><!--]--> Text-to-Speech (Recipe) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/tts_realtime_demo.html" class="" aria-label="ESPnet real time E2E-TTS demonstration"><!--[--><!--]--> ESPnet real time E2E-TTS demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SE</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/se/se_demo.html" class="" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/se/espnet_se_demonstration_for_waspaa_2021.html" class="" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SLU</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/slu/espnet2_2pass_slu_demo.html" class="" aria-label="ESPNET 2 pass SLU Demonstration"><!--[--><!--]--> ESPNET 2 pass SLU Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ST</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/st/st_demo.html" class="" aria-label="ESPnet Speech Translation Demonstration"><!--[--><!--]--> ESPnet Speech Translation Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Others</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/others/pretrained.html" class="" aria-label="Pretrained Model"><!--[--><!--]--> Pretrained Model <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/others/onnx_conversion_demo.html" class="" aria-label="espnet_onnx demonstration"><!--[--><!--]--> espnet_onnx demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Tutorials"><span class="title">Tutorials</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Tutorials"><span class="title">Tutorials</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notebook/tutorials/DataPreparation_CMU_11492_692_Spring2023(Assignment0).html" class="" aria-label="CMU 11492/11692 Spring 2023: Data preparation"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Data preparation <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.html" class="" aria-label="CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task)"><!--[--><!--]--> CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html" class="" aria-label="CMU 11751/18781 Fall 2022: ESPnet Tutorial"><!--[--><!--]--> CMU 11751/18781 Fall 2022: ESPnet Tutorial <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_tutorial_2021_CMU_11751_18781.html" class="" aria-label="CMU 11751/18781 2021: ESPnet Tutorial"><!--[--><!--]--> CMU 11751/18781 2021: ESPnet Tutorial <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/SpeechEnhancement_CMU_11492_692_Spring2023(Assignment7).html" class="" aria-label="CMU 11492/11692 Spring 2023: Speech Enhancement"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Speech Enhancement <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/SpokenLanguageUnderstanding_CMU_11492_692_Spring2023(Assignment6).html" class="" aria-label="CMU 11492/11692 Spring 2023: Spoken Language Understanding"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Spoken Language Understanding <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/TextToSpeech_CMU_11492_692_Spring2023(Assignment8).html" class="" aria-label="CMU 11492/11692 Spring 2023: Text to Speech"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Text to Speech <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ESPnetEasy"><span class="title">ESPnetEasy</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ESPnetEasy"><span class="title">ESPnetEasy</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ASR</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/train.html" class="" aria-label="Sample demo for ESPnet-Easy!"><!--[--><!--]--> Sample demo for ESPnet-Easy! <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/finetune_with_lora.html" class="" aria-label="Finetune Model with ESPnet-Easy"><!--[--><!--]--> Finetune Model with ESPnet-Easy <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/finetune_owsm.html" class="" aria-label="OWSM finetuning with custom dataset"><!--[--><!--]--> OWSM finetuning with custom dataset <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TTS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/tts/tacotron2.html" class="" aria-label="TTS demo for ESPnet-Easy!"><!--[--><!--]--> TTS demo for ESPnet-Easy! <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ESPnet2"><span class="title">ESPnet2</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ESPnet2"><span class="title">ESPnet2</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ASR</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/asr_cli.html" class="" aria-label="Speech Recognition (Recipe)"><!--[--><!--]--> Speech Recognition (Recipe) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/asr_library.html" class="" aria-label="Speech Recognition (Library)"><!--[--><!--]--> Speech Recognition (Library) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_asr_realtime_demo.html" class="" aria-label="ESPnet2-ASR realtime demonstration"><!--[--><!--]--> ESPnet2-ASR realtime demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/notebook/espnet2/asr/espnet2_asr_transfer_learning_demo.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Use transfer learning for ASR in ESPnet2"><!--[--><!--]--> Use transfer learning for ASR in ESPnet2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_streaming_asr_demo.html" class="" aria-label="ESPnet2 real streaming Transformer demonstration"><!--[--><!--]--> ESPnet2 real streaming Transformer demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TTS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/espnet2_tts_realtime_demo.html" class="" aria-label="ESPnet2-TTS realtime demonstration"><!--[--><!--]--> ESPnet2-TTS realtime demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/tts_cli.html" class="" aria-label="Text-to-Speech (Recipe)"><!--[--><!--]--> Text-to-Speech (Recipe) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/tts_realtime_demo.html" class="" aria-label="ESPnet real time E2E-TTS demonstration"><!--[--><!--]--> ESPnet real time E2E-TTS demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SE</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/se/se_demo.html" class="" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/se/espnet_se_demonstration_for_waspaa_2021.html" class="" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SLU</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/slu/espnet2_2pass_slu_demo.html" class="" aria-label="ESPNET 2 pass SLU Demonstration"><!--[--><!--]--> ESPNET 2 pass SLU Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ST</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/st/st_demo.html" class="" aria-label="ESPnet Speech Translation Demonstration"><!--[--><!--]--> ESPnet Speech Translation Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Others</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/others/pretrained.html" class="" aria-label="Pretrained Model"><!--[--><!--]--> Pretrained Model <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/others/onnx_conversion_demo.html" class="" aria-label="espnet_onnx demonstration"><!--[--><!--]--> espnet_onnx demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Tutorials"><span class="title">Tutorials</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Tutorials"><span class="title">Tutorials</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notebook/tutorials/DataPreparation_CMU_11492_692_Spring2023(Assignment0).html" class="" aria-label="CMU 11492/11692 Spring 2023: Data preparation"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Data preparation <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.html" class="" aria-label="CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task)"><!--[--><!--]--> CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html" class="" aria-label="CMU 11751/18781 Fall 2022: ESPnet Tutorial"><!--[--><!--]--> CMU 11751/18781 Fall 2022: ESPnet Tutorial <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_tutorial_2021_CMU_11751_18781.html" class="" aria-label="CMU 11751/18781 2021: ESPnet Tutorial"><!--[--><!--]--> CMU 11751/18781 2021: ESPnet Tutorial <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/SpeechEnhancement_CMU_11492_692_Spring2023(Assignment7).html" class="" aria-label="CMU 11492/11692 Spring 2023: Speech Enhancement"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Speech Enhancement <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/SpokenLanguageUnderstanding_CMU_11492_692_Spring2023(Assignment6).html" class="" aria-label="CMU 11492/11692 Spring 2023: Spoken Language Understanding"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Spoken Language Understanding <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/TextToSpeech_CMU_11492_692_Spring2023(Assignment8).html" class="" aria-label="CMU 11492/11692 Spring 2023: Text to Speech"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Text to Speech <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ESPnetEasy"><span class="title">ESPnetEasy</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ESPnetEasy"><span class="title">ESPnetEasy</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ASR</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/train.html" class="" aria-label="Sample demo for ESPnet-Easy!"><!--[--><!--]--> Sample demo for ESPnet-Easy! <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/finetune_with_lora.html" class="" aria-label="Finetune Model with ESPnet-Easy"><!--[--><!--]--> Finetune Model with ESPnet-Easy <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/finetune_owsm.html" class="" aria-label="OWSM finetuning with custom dataset"><!--[--><!--]--> OWSM finetuning with custom dataset <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TTS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/tts/tacotron2.html" class="" aria-label="TTS demo for ESPnet-Easy!"><!--[--><!--]--> TTS demo for ESPnet-Easy! <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">ASR <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/asr/asr_cli.html" class="sidebar-item" aria-label="Speech Recognition (Recipe)"><!--[--><!--]--> Speech Recognition (Recipe) <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/asr/asr_library.html" class="sidebar-item" aria-label="Speech Recognition (Library)"><!--[--><!--]--> Speech Recognition (Library) <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/asr/espnet2_asr_realtime_demo.html" class="sidebar-item" aria-label="ESPnet2-ASR realtime demonstration"><!--[--><!--]--> ESPnet2-ASR realtime demonstration <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/espnet2_asr_transfer_learning_demo.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Use transfer learning for ASR in ESPnet2"><!--[--><!--]--> Use transfer learning for ASR in ESPnet2 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notebook/espnet2/asr/espnet2_asr_transfer_learning_demo.html#why-using-such-pre-trained-models" class="router-link-active router-link-exact-active sidebar-item" aria-label="Why using such (pre-)trained models ?"><!--[--><!--]--> Why using such (pre-)trained models ? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/espnet2_asr_transfer_learning_demo.html#use-a-trained-model-from-espnet-repository-on-huggingface" class="router-link-active router-link-exact-active sidebar-item" aria-label="Use a trained model from ESPnet repository on HuggingFace."><!--[--><!--]--> Use a trained model from ESPnet repository on HuggingFace. <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/notebook/espnet2/asr/espnet2_streaming_asr_demo.html" class="sidebar-item" aria-label="ESPnet2 real streaming Transformer demonstration"><!--[--><!--]--> ESPnet2 real streaming Transformer demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">TTS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/tts/espnet2_tts_realtime_demo.html" class="sidebar-item" aria-label="ESPnet2-TTS realtime demonstration"><!--[--><!--]--> ESPnet2-TTS realtime demonstration <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/tts/tts_cli.html" class="sidebar-item" aria-label="Text-to-Speech (Recipe)"><!--[--><!--]--> Text-to-Speech (Recipe) <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/tts/tts_realtime_demo.html" class="sidebar-item" aria-label="ESPnet real time E2E-TTS demonstration"><!--[--><!--]--> ESPnet real time E2E-TTS demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">SE <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/se/se_demo.html" class="sidebar-item" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/se/espnet_se_demonstration_for_waspaa_2021.html" class="sidebar-item" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">SLU <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/slu/espnet2_2pass_slu_demo.html" class="sidebar-item" aria-label="ESPNET 2 pass SLU Demonstration"><!--[--><!--]--> ESPNET 2 pass SLU Demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ST <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/st/st_demo.html" class="sidebar-item" aria-label="ESPnet Speech Translation Demonstration"><!--[--><!--]--> ESPnet Speech Translation Demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Others <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/others/pretrained.html" class="sidebar-item" aria-label="Pretrained Model"><!--[--><!--]--> Pretrained Model <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/others/onnx_conversion_demo.html" class="sidebar-item" aria-label="espnet_onnx demonstration"><!--[--><!--]--> espnet_onnx demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="use-transfer-learning-for-asr-in-espnet2" tabindex="-1"><a class="header-anchor" href="#use-transfer-learning-for-asr-in-espnet2"><span><strong>Use transfer learning for ASR in ESPnet2</strong></span></a></h1><p>Author : Dan Berrebbi (dberrebb@andrew.cmu.edu)</p><p>Date : April 11th, 2022</p><h1 id="abstract" tabindex="-1"><a class="header-anchor" href="#abstract"><span>Abstract</span></a></h1><p>In that tutorial, we will introduce several options to use pre-trained models/parameters for Automatic Speech Recognition (ASR) in ESPnet2. Available options are :</p><ul><li>use a local model you (or a collegue) have already trained,</li><li>use a trained model from <a href="https://huggingface.co/espnet" target="_blank" rel="noopener noreferrer">ESPnet repository on HuggingFace<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li></ul><p>We note that this is done for ASR training, so at <strong>stage 11</strong> of ESPnet2 models&#39; recipe.</p><h3 id="why-using-such-pre-trained-models" tabindex="-1"><a class="header-anchor" href="#why-using-such-pre-trained-models"><span>Why using such (pre-)trained models ?</span></a></h3><p>Several projects may involve making use of previously trained models, this is the reason why we developed ESPnet repository on HuggingFace for instance. Example of use cases are listed below (non-exhaustive):</p><ul><li>target a low resource language, a model trained from scratch may perform badly if trained with only few hours of data,</li><li>study robustness to shifts (domain, language ... shifts) of a model,</li><li>make use of massively trained multilingual models.</li><li>...</li></ul><h1 id="espnet-installation-about-10-minutes-in-total" tabindex="-1"><a class="header-anchor" href="#espnet-installation-about-10-minutes-in-total"><span>ESPnet installation (about 10 minutes in total)</span></a></h1><p>Please use the gpu environnement provided by google colab for runing this notebook.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">git clone </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">depth </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;"> https://github.com/espnet/espnet</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It takes 30 seconds</span></span>
<span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/tools</span></span>
<span class="line"><span style="color:#D4D4D4;">!./setup_anaconda.sh anaconda espnet </span><span style="color:#B5CEA8;">3.9</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># It may take ~8 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/tools</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">make CUDA_VERSION=</span><span style="color:#B5CEA8;">10.2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="mini-an4-recipe-as-a-transfer-learning-example" tabindex="-1"><a class="header-anchor" href="#mini-an4-recipe-as-a-transfer-learning-example"><span>mini_an4 recipe as a transfer learning example</span></a></h1><p>In this example, we use the <strong>mini_an4</strong> data, which has only 4 utterances for training. This is of course too small to train an ASR model, but it enables to run all the decribed transfer learning models on a colab environnement. After having run and understood those models/instructions, you can apply it to any other recipe of ESPnet2 or a new recipe that you build. First, move to the recipe directory</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">%cd /content/espnet/egs2/mini_an4/asr1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Add a configuration file</strong></p><p>As the mini_an4 does not contain any configuration file for ASR model, we add one here.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">config = {</span><span style="color:#CE9178;">&#39;accum_grad&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;batch_size&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;batch_type&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;folded&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;best_model_criterion&#39;</span><span style="color:#D4D4D4;">: [[</span><span style="color:#CE9178;">&#39;valid&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;acc&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;max&#39;</span><span style="color:#D4D4D4;">]],</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;decoder&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;transformer&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;decoder_conf&#39;</span><span style="color:#D4D4D4;">: {</span><span style="color:#CE9178;">&#39;dropout_rate&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0.1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;input_layer&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;embed&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;linear_units&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">2048</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;num_blocks&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">6</span><span style="color:#D4D4D4;">},</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;encoder&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;transformer&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;encoder_conf&#39;</span><span style="color:#D4D4D4;">: {</span><span style="color:#CE9178;">&#39;attention_dropout_rate&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0.0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;attention_heads&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;dropout_rate&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0.1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;input_layer&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;conv2d&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;linear_units&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">2048</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;num_blocks&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">12</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;output_size&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">256</span><span style="color:#D4D4D4;">},</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;grad_clip&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;init&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;xavier_uniform&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;keep_nbest_models&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;max_epoch&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;model_conf&#39;</span><span style="color:#D4D4D4;">: {</span><span style="color:#CE9178;">&#39;ctc_weight&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0.3</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;length_normalized_loss&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#569CD6;">False</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;">  &#39;lsm_weight&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0.1</span><span style="color:#D4D4D4;">},</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;optim&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;adam&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;optim_conf&#39;</span><span style="color:#D4D4D4;">: {</span><span style="color:#CE9178;">&#39;lr&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1.0</span><span style="color:#D4D4D4;">},</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;patience&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;scheduler&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&#39;noamlr&#39;</span><span style="color:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;"> &#39;scheduler_conf&#39;</span><span style="color:#D4D4D4;">: {</span><span style="color:#CE9178;">&#39;warmup_steps&#39;</span><span style="color:#D4D4D4;">: </span><span style="color:#B5CEA8;">1000</span><span style="color:#D4D4D4;">}}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> yaml</span></span>
<span class="line"><span style="color:#C586C0;">with</span><span style="color:#DCDCAA;"> open</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;conf/train_asr.yaml&quot;</span><span style="color:#D4D4D4;">,</span><span style="color:#CE9178;">&quot;w&quot;</span><span style="color:#D4D4D4;">) </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> f:</span></span>
<span class="line"><span style="color:#D4D4D4;">  yaml.dump(config, f)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Data preparation (stage 1 - stage 5)</strong></p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">1</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">5</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_nodev&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">valid-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_dev&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;test&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Stage 10: ASR collect stats</strong>:</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># takes about 10 seconds</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">10</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">10</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_nodev&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">valid-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_dev&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asr_config </span><span style="color:#CE9178;">&quot;conf/train_asr.yaml&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Stage 11: ASR training (from scratch)</strong></p><p>We train our model for only 5 epochs, just to have a pre-trained model.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># takes about 1-2 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_nodev&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">valid-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_dev&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asr_config </span><span style="color:#CE9178;">&quot;conf/train_asr.yaml&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asr_tag </span><span style="color:#CE9178;">&quot;pre_trained_model&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Stage 11.2 : ASR training over a pre-trained model</strong></p><p>We train our new model over the previously trained model. (here as we use the same training data, this is not very useful, but again this is a toy example that is reproducible with any model.)</p><p><strong>Step 1</strong> : make sure your ASR model file has the proper ESPnet format (should be ok if trained with ESPnet). It just needs to be a &quot;.pth&quot; (or &quot;.pt&quot; or other extension) type pytorch model.</p><p><strong>Step 2</strong> : add the parameter <code>--pretrained_model path/to/your/pretrained/model/file.pth</code> to run.sh.</p><p><strong>Step 3</strong> : step 2 will initialize your new model with the parameters of the pre-trained model. Thus your new model will be trained with a strong initialization. However, if your new model have different parameter sizes for some parts of the model (e.g. last projection layer could be modified ...). This will lead to an error because of mismatches in size. To prevent this to happen, you can add the parameter <code>--ignore_init_mismatch true</code> in run.sh.</p><p><strong>Step 4 (Optional)</strong> : if you only want to use some specific parts of the pre-trained model, or exclude specific parts, you can specify it in the <code>--pretrained_model</code> argument by passing the component names with the following syntax : <code>--pretrained_model &lt;file_path&gt;:&lt;src_key&gt;:&lt;dst_key&gt;:&lt;exclude_Keys&gt;</code>. <code>src_key</code> are the parameters you want to keep from the pre-trained model. <code>dst_key</code> are the parameters you want to initialize in the new model with the <code>src_key</code>parameters. And <code>exclude_Keys</code> are the parameters from the pre-trained model that you do not want to use. You can leave <code>src_key</code> and <code>dst_key</code> fields empty and just fill <code>exclude_Keys</code> with the parameters that you ant to drop. For instance, if you want to re-use encoder parameters but not decoder ones, syntax will be <code>--pretrained_model &lt;file_path&gt;:::decoder</code>. You can see the argument expected format in more details <a href="https://github.com/espnet/espnet/blob/e76c78c0c661ab37cc081d46d9b059dcb31292fe/espnet2/torch_utils/load_pretrained_model.py#L43-L53" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># takes about 1-2 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_nodev&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">valid-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_dev&quot;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asr_config </span><span style="color:#CE9178;">&quot;conf/train_asr.yaml&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asr_tag </span><span style="color:#CE9178;">&quot;transfer_learning_with_pre_trained_model&quot;</span><span style="color:#D4D4D4;">\</span></span>
<span class="line"><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">pretrained_model </span><span style="color:#CE9178;">&quot;/content/espnet/egs2/mini_an4/asr1/exp/asr_train_asr_raw_bpe30/valid.acc.ave.pth&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Stage 11.3 : ASR training over a HuggingFace pre-trained model</strong></p><p>We train our new model over the previously trained model from HuggingFace. Any model can be used, here we take a model trained on Bengali as an example. It can be found at https://huggingface.co/espnet/bn_openslr53.</p><h3 id="use-a-trained-model-from-espnet-repository-on-huggingface" tabindex="-1"><a class="header-anchor" href="#use-a-trained-model-from-espnet-repository-on-huggingface"><span>Use a trained model from ESPnet repository on HuggingFace.</span></a></h3><p><a href="https://huggingface.co/espnet" target="_blank" rel="noopener noreferrer">ESPnet repository on HuggingFace<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> contains more than 200 pre-trained models, for a wide variety of languages and dataset, and we are actively expanding this repositories with new models every week! This enable any user to perform transfer learning with a wide variety of models without having to re-train them. In order to use our pre-trained models, the first step is to download the &quot;.pth&quot; model file from the <a href="https://huggingface.co/espnet" target="_blank" rel="noopener noreferrer">HugginFace page<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. There are several easy way to do it, either by manually downloading them (e.g. <code>wget https://huggingface.co/espnet/bn_openslr53/blob/main/exp/asr_train_asr_raw_bpe1000/41epoch.pth</code>), cloning it (<code>git clone https://huggingface.co/espnet/bn_openslr53</code>) or downloading it through an ESPnet recipe (described in the models&#39; pages on HuggingFace):</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span>cd espnet</span></span>
<span class="line"><span>git checkout fa1b865352475b744c37f70440de1cc6b257ba70</span></span>
<span class="line"><span>pip install -e .</span></span>
<span class="line"><span>cd egs2/bn_openslr53/asr1</span></span>
<span class="line"><span>./run.sh --skip_data_prep false --skip_train true --download_model espnet/bn_openslr53</span></span>
<span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then, as you have the &quot;.pth&quot; model file, you can follow the steps 1 to 4 from the previous section in order to use this pre-train model.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">wget https://huggingface.co/espnet/bn_openslr53/resolve/main/exp/asr_train_asr_raw_bpe1000/</span><span style="color:#F44747;">41epoch</span><span style="color:#D4D4D4;">.pth</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The next command line will raise an error because of the size mismatch of some parameters, as mentionned before (step3).</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># will fail in about 5 seconds</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_nodev&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">valid-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_dev&quot;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asr_config </span><span style="color:#CE9178;">&quot;conf/train_asr.yaml&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asr_tag </span><span style="color:#CE9178;">&quot;transfer_learning_with_pre_trained_model&quot;</span><span style="color:#D4D4D4;">\</span></span>
<span class="line"><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">pretrained_model </span><span style="color:#CE9178;">&quot;/content/espnet/egs2/mini_an4/asr1/41epoch.pth&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To solve this issue, as mentionned, we can use the <code>--ignore_init_mismatch &quot;true&quot;</code> parameter.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># takes about 1-2 minutes</span></span>
<span class="line"><span style="color:#D4D4D4;">!./asr.sh </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop_stage </span><span style="color:#B5CEA8;">11</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_nodev&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">valid-</span><span style="color:#4EC9B0;">set</span><span style="color:#CE9178;"> &quot;train_dev&quot;</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">test_sets </span><span style="color:#CE9178;">&quot;test&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asr_config </span><span style="color:#CE9178;">&quot;conf/train_asr.yaml&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">asr_tag </span><span style="color:#CE9178;">&quot;transfer_learning_with_pre_trained_model_from_HF&quot;</span><span style="color:#D4D4D4;">\</span></span>
<span class="line"><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">pretrained_model </span><span style="color:#CE9178;">&quot;/content/espnet/egs2/mini_an4/asr1/41epoch.pth&quot;</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">ignore_init_mismatch </span><span style="color:#CE9178;">&quot;true&quot;</span><span style="color:#D4D4D4;"> </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Additional note about the <code>--ignore_init_mismatch true</code> option :</strong> This option is very convenient because in lots of transfer learning use cases, you will aim to use a model trained on a language X (e.g. X=English) for another language Y. Language Y may have a vocabulary (set of tokens) different from language X, for instance if you target Y=Totonac, a Mexican low resource language, your model may be stronger if you use a different set of bpes/tokens thatn the one used to train the English model. In that situation, the last layer (projection to vocabulary space) of your ASR model needs to be initialized from scratch and may be different in shape than the one of the English model. For that reason, you should use the <code>--ignore_init_mismatch true</code> option. It also enables to handle the case where the scripts are differents from languages X to Y.</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav" aria-label="page navigation"><p class="inner"><span class="prev"><a href="/notebook/espnet2/asr/espnet2_asr_realtime_demo.html" class="" aria-label="ESPnet2-ASR realtime demonstration"><!--[--><!--]--> ESPnet2-ASR realtime demonstration <!--[--><!--]--></a></span><span class="next"><a href="/notebook/espnet2/asr/espnet2_streaming_asr_demo.html" class="" aria-label="ESPnet2 real streaming Transformer demonstration"><!--[--><!--]--> ESPnet2 real streaming Transformer demonstration <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/notebook/assets/app-FOR18dDf.js" defer></script>
  </body>
</html>
