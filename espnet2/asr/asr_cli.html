<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.2" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <link rel="manifest" href="/manifest.webmanifest"><meta name="application-name" content="Example"><meta name="apple-mobile-web-app-title" content="Example"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileColor" content="#3eaf7c"><meta name="theme-color" content="#3eaf7c"><title>Speech Recognition (Recipe) | ESPnet-Example</title><meta name="description" content="Example notebooks for ESPnet">
    <link rel="preload" href="/notebook/assets/style-cp41dQ25.css" as="style"><link rel="stylesheet" href="/notebook/assets/style-cp41dQ25.css">
    <link rel="modulepreload" href="/notebook/assets/app-FOR18dDf.js"><link rel="modulepreload" href="/notebook/assets/asr_cli.html-knKjgurg.js"><link rel="modulepreload" href="/notebook/assets/asr_cli.html-JH3saHIF.js">
    <link rel="prefetch" href="/notebook/assets/index.html-XAvCBsD6.js" as="script"><link rel="prefetch" href="/notebook/assets/DataPreparation_CMU_11492_692_Spring2023(Assignment0).html-KBtpWdkS.js" as="script"><link rel="prefetch" href="/notebook/assets/SpeechEnhancement_CMU_11492_692_Spring2023(Assignment7).html-ojQTonzi.js" as="script"><link rel="prefetch" href="/notebook/assets/SpokenLanguageUnderstanding_CMU_11492_692_Spring2023(Assignment6).html-k7t3PiyY.js" as="script"><link rel="prefetch" href="/notebook/assets/TextToSpeech_CMU_11492_692_Spring2023(Assignment8).html-mugYinQi.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.html-xjN-GwTF.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html-IaNcm8K-.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_tutorial_2021_CMU_11751_18781.html-IMfnLI01.js" as="script"><link rel="prefetch" href="/notebook/assets/asr_library.html-nD4wSonE.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_asr_realtime_demo.html-31qj-nF8.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_asr_transfer_learning_demo.html-K8AGvfnJ.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_streaming_asr_demo.html-NgcmLWnC.js" as="script"><link rel="prefetch" href="/notebook/assets/onnx_conversion_demo.html-wfKipc9w.js" as="script"><link rel="prefetch" href="/notebook/assets/pretrained.html--Y7vPVCq.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet_se_demonstration_for_waspaa_2021.html-_RqduImg.js" as="script"><link rel="prefetch" href="/notebook/assets/se_demo.html-zhHwqNB_.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_2pass_slu_demo.html-SOe7ZUtq.js" as="script"><link rel="prefetch" href="/notebook/assets/st_demo.html-_JBPLyfl.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_tts_realtime_demo.html-9h1FXENI.js" as="script"><link rel="prefetch" href="/notebook/assets/tts_cli.html-OLkBd5Fu.js" as="script"><link rel="prefetch" href="/notebook/assets/tts_realtime_demo.html-Bgn0MtVH.js" as="script"><link rel="prefetch" href="/notebook/assets/finetune_owsm.html-oRbSv_3K.js" as="script"><link rel="prefetch" href="/notebook/assets/finetune_with_lora.html-53DWrWT9.js" as="script"><link rel="prefetch" href="/notebook/assets/train.html-ZtrUU739.js" as="script"><link rel="prefetch" href="/notebook/assets/tacotron2.html-lMDTfHXx.js" as="script"><link rel="prefetch" href="/notebook/assets/404.html-6Yl8cQE3.js" as="script"><link rel="prefetch" href="/notebook/assets/index.html-Fa1mvKNA.js" as="script"><link rel="prefetch" href="/notebook/assets/DataPreparation_CMU_11492_692_Spring2023(Assignment0).html-yZnfE8Rl.js" as="script"><link rel="prefetch" href="/notebook/assets/SpeechEnhancement_CMU_11492_692_Spring2023(Assignment7).html-EtOqTzx1.js" as="script"><link rel="prefetch" href="/notebook/assets/SpokenLanguageUnderstanding_CMU_11492_692_Spring2023(Assignment6).html-3QqySz0B.js" as="script"><link rel="prefetch" href="/notebook/assets/TextToSpeech_CMU_11492_692_Spring2023(Assignment8).html-oKNm4LpP.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.html-4zeeKKut.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html-Xne2M8JW.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_tutorial_2021_CMU_11751_18781.html-HhdidVDJ.js" as="script"><link rel="prefetch" href="/notebook/assets/asr_library.html-Kz7KwH4E.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_asr_realtime_demo.html-RYvF9e8R.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_asr_transfer_learning_demo.html-IksoduPb.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_streaming_asr_demo.html-6EF7rYtq.js" as="script"><link rel="prefetch" href="/notebook/assets/onnx_conversion_demo.html-1dXBgI7d.js" as="script"><link rel="prefetch" href="/notebook/assets/pretrained.html-bRY7ZLad.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet_se_demonstration_for_waspaa_2021.html-53aPYjLT.js" as="script"><link rel="prefetch" href="/notebook/assets/se_demo.html-0y7hJZOb.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_2pass_slu_demo.html-LPf_aa6M.js" as="script"><link rel="prefetch" href="/notebook/assets/st_demo.html-GjLoLXxU.js" as="script"><link rel="prefetch" href="/notebook/assets/espnet2_tts_realtime_demo.html-NCcWLTBY.js" as="script"><link rel="prefetch" href="/notebook/assets/tts_cli.html-Elg6sapX.js" as="script"><link rel="prefetch" href="/notebook/assets/tts_realtime_demo.html-wTutqUQW.js" as="script"><link rel="prefetch" href="/notebook/assets/finetune_owsm.html-BKHMtCfm.js" as="script"><link rel="prefetch" href="/notebook/assets/finetune_with_lora.html-h3VNWfNm.js" as="script"><link rel="prefetch" href="/notebook/assets/train.html-zSf_6N6D.js" as="script"><link rel="prefetch" href="/notebook/assets/tacotron2.html-gzrp5q7X.js" as="script"><link rel="prefetch" href="/notebook/assets/404.html-8hkKDKOa.js" as="script"><link rel="prefetch" href="/notebook/assets/NpmBadge-ZlH3swud.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/notebook/" class=""><img class="logo" src="/notebook/images/espnet_logo1.png" alt="ESPnet-Example"><span class="site-name can-hide" aria-hidden="true">ESPnet-Example</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ESPnet2"><span class="title">ESPnet2</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ESPnet2"><span class="title">ESPnet2</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ASR</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Speech Recognition (Recipe)"><!--[--><!--]--> Speech Recognition (Recipe) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/asr_library.html" class="" aria-label="Speech Recognition (Library)"><!--[--><!--]--> Speech Recognition (Library) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_asr_realtime_demo.html" class="" aria-label="ESPnet2-ASR realtime demonstration"><!--[--><!--]--> ESPnet2-ASR realtime demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_asr_transfer_learning_demo.html" class="" aria-label="Use transfer learning for ASR in ESPnet2"><!--[--><!--]--> Use transfer learning for ASR in ESPnet2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_streaming_asr_demo.html" class="" aria-label="ESPnet2 real streaming Transformer demonstration"><!--[--><!--]--> ESPnet2 real streaming Transformer demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TTS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/espnet2_tts_realtime_demo.html" class="" aria-label="ESPnet2-TTS realtime demonstration"><!--[--><!--]--> ESPnet2-TTS realtime demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/tts_cli.html" class="" aria-label="Text-to-Speech (Recipe)"><!--[--><!--]--> Text-to-Speech (Recipe) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/tts_realtime_demo.html" class="" aria-label="ESPnet real time E2E-TTS demonstration"><!--[--><!--]--> ESPnet real time E2E-TTS demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SE</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/se/se_demo.html" class="" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/se/espnet_se_demonstration_for_waspaa_2021.html" class="" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SLU</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/slu/espnet2_2pass_slu_demo.html" class="" aria-label="ESPNET 2 pass SLU Demonstration"><!--[--><!--]--> ESPNET 2 pass SLU Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ST</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/st/st_demo.html" class="" aria-label="ESPnet Speech Translation Demonstration"><!--[--><!--]--> ESPnet Speech Translation Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Others</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/others/pretrained.html" class="" aria-label="Pretrained Model"><!--[--><!--]--> Pretrained Model <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/others/onnx_conversion_demo.html" class="" aria-label="espnet_onnx demonstration"><!--[--><!--]--> espnet_onnx demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Tutorials"><span class="title">Tutorials</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Tutorials"><span class="title">Tutorials</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notebook/tutorials/DataPreparation_CMU_11492_692_Spring2023(Assignment0).html" class="" aria-label="CMU 11492/11692 Spring 2023: Data preparation"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Data preparation <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.html" class="" aria-label="CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task)"><!--[--><!--]--> CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html" class="" aria-label="CMU 11751/18781 Fall 2022: ESPnet Tutorial"><!--[--><!--]--> CMU 11751/18781 Fall 2022: ESPnet Tutorial <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_tutorial_2021_CMU_11751_18781.html" class="" aria-label="CMU 11751/18781 2021: ESPnet Tutorial"><!--[--><!--]--> CMU 11751/18781 2021: ESPnet Tutorial <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/SpeechEnhancement_CMU_11492_692_Spring2023(Assignment7).html" class="" aria-label="CMU 11492/11692 Spring 2023: Speech Enhancement"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Speech Enhancement <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/SpokenLanguageUnderstanding_CMU_11492_692_Spring2023(Assignment6).html" class="" aria-label="CMU 11492/11692 Spring 2023: Spoken Language Understanding"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Spoken Language Understanding <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/TextToSpeech_CMU_11492_692_Spring2023(Assignment8).html" class="" aria-label="CMU 11492/11692 Spring 2023: Text to Speech"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Text to Speech <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ESPnetEasy"><span class="title">ESPnetEasy</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ESPnetEasy"><span class="title">ESPnetEasy</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ASR</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/train.html" class="" aria-label="Sample demo for ESPnet-Easy!"><!--[--><!--]--> Sample demo for ESPnet-Easy! <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/finetune_with_lora.html" class="" aria-label="Finetune Model with ESPnet-Easy"><!--[--><!--]--> Finetune Model with ESPnet-Easy <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/finetune_owsm.html" class="" aria-label="OWSM finetuning with custom dataset"><!--[--><!--]--> OWSM finetuning with custom dataset <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TTS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/tts/tacotron2.html" class="" aria-label="TTS demo for ESPnet-Easy!"><!--[--><!--]--> TTS demo for ESPnet-Easy! <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ESPnet2"><span class="title">ESPnet2</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ESPnet2"><span class="title">ESPnet2</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ASR</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Speech Recognition (Recipe)"><!--[--><!--]--> Speech Recognition (Recipe) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/asr_library.html" class="" aria-label="Speech Recognition (Library)"><!--[--><!--]--> Speech Recognition (Library) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_asr_realtime_demo.html" class="" aria-label="ESPnet2-ASR realtime demonstration"><!--[--><!--]--> ESPnet2-ASR realtime demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_asr_transfer_learning_demo.html" class="" aria-label="Use transfer learning for ASR in ESPnet2"><!--[--><!--]--> Use transfer learning for ASR in ESPnet2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/asr/espnet2_streaming_asr_demo.html" class="" aria-label="ESPnet2 real streaming Transformer demonstration"><!--[--><!--]--> ESPnet2 real streaming Transformer demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TTS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/espnet2_tts_realtime_demo.html" class="" aria-label="ESPnet2-TTS realtime demonstration"><!--[--><!--]--> ESPnet2-TTS realtime demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/tts_cli.html" class="" aria-label="Text-to-Speech (Recipe)"><!--[--><!--]--> Text-to-Speech (Recipe) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/tts/tts_realtime_demo.html" class="" aria-label="ESPnet real time E2E-TTS demonstration"><!--[--><!--]--> ESPnet real time E2E-TTS demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SE</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/se/se_demo.html" class="" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/se/espnet_se_demonstration_for_waspaa_2021.html" class="" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>SLU</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/slu/espnet2_2pass_slu_demo.html" class="" aria-label="ESPNET 2 pass SLU Demonstration"><!--[--><!--]--> ESPNET 2 pass SLU Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ST</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/st/st_demo.html" class="" aria-label="ESPnet Speech Translation Demonstration"><!--[--><!--]--> ESPnet Speech Translation Demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Others</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/others/pretrained.html" class="" aria-label="Pretrained Model"><!--[--><!--]--> Pretrained Model <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnet2/others/onnx_conversion_demo.html" class="" aria-label="espnet_onnx demonstration"><!--[--><!--]--> espnet_onnx demonstration <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Tutorials"><span class="title">Tutorials</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Tutorials"><span class="title">Tutorials</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/notebook/tutorials/DataPreparation_CMU_11492_692_Spring2023(Assignment0).html" class="" aria-label="CMU 11492/11692 Spring 2023: Data preparation"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Data preparation <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_new_task_tutorial_CMU_11751_18781_Fall2022.html" class="" aria-label="CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task)"><!--[--><!--]--> CMU 11751/18781 Fall 2022: ESPnet Tutorial2 (New task) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_recipe_tutorial_CMU_11751_18781_Fall2022.html" class="" aria-label="CMU 11751/18781 Fall 2022: ESPnet Tutorial"><!--[--><!--]--> CMU 11751/18781 Fall 2022: ESPnet Tutorial <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/espnet2_tutorial_2021_CMU_11751_18781.html" class="" aria-label="CMU 11751/18781 2021: ESPnet Tutorial"><!--[--><!--]--> CMU 11751/18781 2021: ESPnet Tutorial <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/SpeechEnhancement_CMU_11492_692_Spring2023(Assignment7).html" class="" aria-label="CMU 11492/11692 Spring 2023: Speech Enhancement"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Speech Enhancement <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/SpokenLanguageUnderstanding_CMU_11492_692_Spring2023(Assignment6).html" class="" aria-label="CMU 11492/11692 Spring 2023: Spoken Language Understanding"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Spoken Language Understanding <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/notebook/tutorials/TextToSpeech_CMU_11492_692_Spring2023(Assignment8).html" class="" aria-label="CMU 11492/11692 Spring 2023: Text to Speech"><!--[--><!--]--> CMU 11492/11692 Spring 2023: Text to Speech <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ESPnetEasy"><span class="title">ESPnetEasy</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ESPnetEasy"><span class="title">ESPnetEasy</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>ASR</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/train.html" class="" aria-label="Sample demo for ESPnet-Easy!"><!--[--><!--]--> Sample demo for ESPnet-Easy! <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/finetune_with_lora.html" class="" aria-label="Finetune Model with ESPnet-Easy"><!--[--><!--]--> Finetune Model with ESPnet-Easy <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/asr/finetune_owsm.html" class="" aria-label="OWSM finetuning with custom dataset"><!--[--><!--]--> OWSM finetuning with custom dataset <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TTS</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/notebook/espnetez/tts/tacotron2.html" class="" aria-label="TTS demo for ESPnet-Easy!"><!--[--><!--]--> TTS demo for ESPnet-Easy! <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">ASR <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Speech Recognition (Recipe)"><!--[--><!--]--> Speech Recognition (Recipe) <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#abstract" class="router-link-active router-link-exact-active sidebar-item" aria-label="Abstract"><!--[--><!--]--> Abstract <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#installation" class="router-link-active router-link-exact-active sidebar-item" aria-label="Installation"><!--[--><!--]--> Installation <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#espnet-command-line-usage-espnet-egs-xxx" class="router-link-active router-link-exact-active sidebar-item" aria-label="ESPnet command line usage (espnet/egs/xxx)"><!--[--><!--]--> ESPnet command line usage (espnet/egs/xxx) <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#stage-0-2-data-preparation" class="router-link-active router-link-exact-active sidebar-item" aria-label="Stage 0 - 2 Data preparation"><!--[--><!--]--> Stage 0 - 2 Data preparation <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#kaldi-style-directory-structure" class="router-link-active router-link-exact-active sidebar-item" aria-label="Kaldi-style directory structure"><!--[--><!--]--> Kaldi-style directory structure <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#tips-essential-files-in-data-preparation" class="router-link-active router-link-exact-active sidebar-item" aria-label="TIPS: essential files in data preparation"><!--[--><!--]--> TIPS: essential files in data preparation <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#raw-text-list" class="router-link-active router-link-exact-active sidebar-item" aria-label="raw text list"><!--[--><!--]--> raw text list <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#tips-explore-datasets-with-data-json" class="router-link-active router-link-exact-active sidebar-item" aria-label="TIPS: explore datasets with data.json"><!--[--><!--]--> TIPS: explore datasets with data.json <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#stage-3-4-nn-training" class="router-link-active router-link-exact-active sidebar-item" aria-label="Stage 3 - 4 NN Training"><!--[--><!--]--> Stage 3 - 4 NN Training <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#tips-change-yaml-py" class="router-link-active router-link-exact-active sidebar-item" aria-label="TIPS: change_yaml.py"><!--[--><!--]--> TIPS: change_yaml.py <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#tips-tensorboard" class="router-link-active router-link-exact-active sidebar-item" aria-label="TIPS: tensorboard"><!--[--><!--]--> TIPS: tensorboard <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#decoding-and-evaluation" class="router-link-active router-link-exact-active sidebar-item" aria-label="Decoding and evaluation"><!--[--><!--]--> Decoding and evaluation <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/notebook/espnet2/asr/asr_cli.html#recognize-speech-from-python" class="router-link-active router-link-exact-active sidebar-item" aria-label="Recognize speech from python"><!--[--><!--]--> Recognize speech from python <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/notebook/espnet2/asr/asr_library.html" class="sidebar-item" aria-label="Speech Recognition (Library)"><!--[--><!--]--> Speech Recognition (Library) <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/asr/espnet2_asr_realtime_demo.html" class="sidebar-item" aria-label="ESPnet2-ASR realtime demonstration"><!--[--><!--]--> ESPnet2-ASR realtime demonstration <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/asr/espnet2_asr_transfer_learning_demo.html" class="sidebar-item" aria-label="Use transfer learning for ASR in ESPnet2"><!--[--><!--]--> Use transfer learning for ASR in ESPnet2 <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/asr/espnet2_streaming_asr_demo.html" class="sidebar-item" aria-label="ESPnet2 real streaming Transformer demonstration"><!--[--><!--]--> ESPnet2 real streaming Transformer demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">TTS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/tts/espnet2_tts_realtime_demo.html" class="sidebar-item" aria-label="ESPnet2-TTS realtime demonstration"><!--[--><!--]--> ESPnet2-TTS realtime demonstration <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/tts/tts_cli.html" class="sidebar-item" aria-label="Text-to-Speech (Recipe)"><!--[--><!--]--> Text-to-Speech (Recipe) <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/tts/tts_realtime_demo.html" class="sidebar-item" aria-label="ESPnet real time E2E-TTS demonstration"><!--[--><!--]--> ESPnet real time E2E-TTS demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">SE <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/se/se_demo.html" class="sidebar-item" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/se/espnet_se_demonstration_for_waspaa_2021.html" class="sidebar-item" aria-label="ESPnet Speech Enhancement Demonstration"><!--[--><!--]--> ESPnet Speech Enhancement Demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">SLU <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/slu/espnet2_2pass_slu_demo.html" class="sidebar-item" aria-label="ESPNET 2 pass SLU Demonstration"><!--[--><!--]--> ESPNET 2 pass SLU Demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">ST <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/st/st_demo.html" class="sidebar-item" aria-label="ESPnet Speech Translation Demonstration"><!--[--><!--]--> ESPnet Speech Translation Demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Others <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/notebook/espnet2/others/pretrained.html" class="sidebar-item" aria-label="Pretrained Model"><!--[--><!--]--> Pretrained Model <!--[--><!--]--></a><!----></li><li><a href="/notebook/espnet2/others/onnx_conversion_demo.html" class="sidebar-item" aria-label="espnet_onnx demonstration"><!--[--><!--]--> espnet_onnx demonstration <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="speech-recognition-recipe" tabindex="-1"><a class="header-anchor" href="#speech-recognition-recipe"><span>Speech Recognition (Recipe)</span></a></h1><p>Author: <a href="https://github.com/ShigekiKarita" target="_blank" rel="noopener noreferrer">Shigeki Karita<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>July 29 2019</p><p>ESPnet Hackathon 2019 @Tokyo</p><h2 id="abstract" tabindex="-1"><a class="header-anchor" href="#abstract"><span>Abstract</span></a></h2><p>This example shows you a practical ASR example using ESPnet as a command line interface, and also as a library.</p><p>See also</p><ul><li>documetation https://espnet.github.io/espnet/</li><li>github https://github.com/espnet</li></ul><h2 id="installation" tabindex="-1"><a class="header-anchor" href="#installation"><span>Installation</span></a></h2><p>ESPnet depends on Kaldi ASR toolkit and Warp-CTC. This will take a few minutes.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;"># OS setup</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">sudo apt-get install bc tree</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cat /etc/os-release</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># espnet setup</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">git clone https://github.com/espnet/espnet</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cd espnet; pip install -e .</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">mkdir -p espnet/tools/venv/</span><span style="color:#DCDCAA;">bin</span><span style="color:#D4D4D4;">; touch espnet/tools/venv/</span><span style="color:#DCDCAA;">bin</span><span style="color:#D4D4D4;">/activate</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># warp ctc setup</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">git clone https://github.com/espnet/warp-ctc -b pytorch-</span><span style="color:#B5CEA8;">1.1</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cd warp-ctc </span><span style="color:#F44747;">&amp;&amp;</span><span style="color:#D4D4D4;"> mkdir build </span><span style="color:#F44747;">&amp;&amp;</span><span style="color:#D4D4D4;"> cd build </span><span style="color:#F44747;">&amp;&amp;</span><span style="color:#D4D4D4;"> cmake .. </span><span style="color:#F44747;">&amp;&amp;</span><span style="color:#D4D4D4;"> make -j4</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cd warp-ctc/pytorch_binding </span><span style="color:#F44747;">&amp;&amp;</span><span style="color:#D4D4D4;"> python setup.py install </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># kaldi setup</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cd ./espnet/tools; git clone https://github.com/kaldi-asr/kaldi</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">echo </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;"> &gt; ./espnet/tools/kaldi/tools/extras/check_dependencies.sh </span><span style="color:#6A9955;"># ignore check</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">chmod +x ./espnet/tools/kaldi/tools/extras/check_dependencies.sh</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cd ./espnet/tools/kaldi/tools; make sph2pipe sclite</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">rm -rf espnet/tools/kaldi/tools/python</span></span>
<span class="line"><span style="color:#D4D4D4;">![ ! -e ubuntu16-featbin.tar.gz ] </span><span style="color:#F44747;">&amp;&amp;</span><span style="color:#D4D4D4;"> wget https://</span><span style="color:#B5CEA8;">18</span><span style="color:#D4D4D4;">-</span><span style="color:#B5CEA8;">198329952</span><span style="color:#D4D4D4;">-gh.circle-artifacts.com/</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">/home/circleci/repo/ubuntu16-featbin.tar.gz</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">tar -xf ./ubuntu16-featbin.tar.gz</span></span>
<span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cp featbin/* espnet/tools/kaldi/src/featbin/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="espnet-command-line-usage-espnet-egs-xxx" tabindex="-1"><a class="header-anchor" href="#espnet-command-line-usage-espnet-egs-xxx"><span>ESPnet command line usage (espnet/egs/xxx)</span></a></h2><p>You can use the end-to-end script <code>run.sh</code> for reproducing systems reported in <code>espnet/egs/*/asr1/RESULTS.md</code>. Typically, we organize <code>run.sh</code> with several stages:</p><ol start="0"><li>Data download (if available)</li><li>Kaldi-style data preparation</li><li>Save python-friendly data (e.g., JSON, HDF5, etc)</li><li>Language model training</li><li>ASR model training</li><li>Decoding and evaluation</li></ol><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">ls espnet/egs</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="stage-0-2-data-preparation" tabindex="-1"><a class="header-anchor" href="#stage-0-2-data-preparation"><span>Stage 0 - 2 Data preparation</span></a></h3><p>For example, if you add <code>--stop-stage 2</code>, you can stop the script before neural network training.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cd espnet/egs/an4/asr1; ./run.sh  </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">ngpu </span><span style="color:#B5CEA8;">1</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop-stage </span><span style="color:#B5CEA8;">2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="kaldi-style-directory-structure" tabindex="-1"><a class="header-anchor" href="#kaldi-style-directory-structure"><span>Kaldi-style directory structure</span></a></h2><p>Always we organize each recipe placed in <code>egs/xxx/asr1</code> in Kaldi way:</p><ul><li><code>conf/</code>: kaldi configurations, e.g., speech feature</li><li><code>data/</code>: almost raw <a href="https://kaldi-asr.org/doc/data_prep.html" target="_blank" rel="noopener noreferrer">data prepared by Kaldi<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><code>exp/</code>: intermidiate files through experiments, e.g., log files, model parameters</li><li><code>fbank/</code>: speech feature binary files, e.g., <a href="https://kaldi-asr.org/doc/io.html" target="_blank" rel="noopener noreferrer">ark, scp<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><code>dump/</code>: ESPnet meta data for tranining, e.g., json, hdf5</li><li><code>local/</code>: corpus specific data preparation scripts</li><li><a href="https://github.com/kaldi-asr/kaldi/tree/master/egs/wsj/s5/steps" target="_blank" rel="noopener noreferrer">steps/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, <a href="https://github.com/kaldi-asr/kaldi/tree/master/egs/wsj/s5/utils" target="_blank" rel="noopener noreferrer">utils/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: Kaldi&#39;s helper scripts</li></ul><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">tree -L </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;"> espnet/egs/an4/asr1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="tips-essential-files-in-data-preparation" tabindex="-1"><a class="header-anchor" href="#tips-essential-files-in-data-preparation"><span>TIPS: essential files in data preparation</span></a></h3><p>To create a new recipe, all you need is stage 1 that creates key-value pair files:</p><ul><li>speech<code>data/xxx/wav.scp</code></li><li>text<code>data/xxx/text</code></li></ul><h4 id="raw-speech-file-list" tabindex="-1"><a class="header-anchor" href="#raw-speech-file-list"><span>raw speech file list</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">head espnet/egs/an4/asr1/data/train/wav.scp</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="raw-text-list" tabindex="-1"><a class="header-anchor" href="#raw-text-list"><span>raw text list</span></a></h3><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">head espnet/egs/an4/asr1/data/train/text</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="tips-explore-datasets-with-data-json" tabindex="-1"><a class="header-anchor" href="#tips-explore-datasets-with-data-json"><span>TIPS: explore datasets with data.json</span></a></h3><p>To explore datasets easily, ESPnet stores metadata <code>dump/xxx/data.json</code> in the stage 2.</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> json</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> matplotlib.pyplot </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> plt</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> kaldiio</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># load 10-th speech/text in data.json</span></span>
<span class="line"><span style="color:#D4D4D4;">root = </span><span style="color:#CE9178;">&quot;espnet/egs/an4/asr1&quot;</span></span>
<span class="line"><span style="color:#C586C0;">with</span><span style="color:#DCDCAA;"> open</span><span style="color:#D4D4D4;">(root + </span><span style="color:#CE9178;">&quot;/dump/test/deltafalse/data.json&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;r&quot;</span><span style="color:#D4D4D4;">) </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> f:</span></span>
<span class="line"><span style="color:#D4D4D4;">  test_json = json.load(f)[</span><span style="color:#CE9178;">&quot;utts&quot;</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span></span>
<span class="line"><span style="color:#D4D4D4;">key, info = </span><span style="color:#4EC9B0;">list</span><span style="color:#D4D4D4;">(test_json.items())[</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># plot the speech feature</span></span>
<span class="line"><span style="color:#D4D4D4;">fbank = kaldiio.load_mat(info[</span><span style="color:#CE9178;">&quot;input&quot;</span><span style="color:#D4D4D4;">][</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">][</span><span style="color:#CE9178;">&quot;feat&quot;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#D4D4D4;">plt.matshow(fbank.T[::-</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#D4D4D4;">plt.title(key + </span><span style="color:#CE9178;">&quot;: &quot;</span><span style="color:#D4D4D4;"> + info[</span><span style="color:#CE9178;">&quot;output&quot;</span><span style="color:#D4D4D4;">][</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">][</span><span style="color:#CE9178;">&quot;text&quot;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># print the key-value pair</span></span>
<span class="line"><span style="color:#D4D4D4;">key, info</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="stage-3-4-nn-training" tabindex="-1"><a class="header-anchor" href="#stage-3-4-nn-training"><span>Stage 3 - 4 NN Training</span></a></h3><p>Let&#39;s go to the most interesting part...</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">tail espnet/egs/an4/asr1/conf/train_mtlalpha1.0.yaml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cd espnet/egs/an4/asr1; ./run.sh  </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">ngpu </span><span style="color:#B5CEA8;">1</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">3</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop-stage </span><span style="color:#B5CEA8;">4</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">train-config ./conf/train_mtlalpha1.0.yaml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="tips-change-yaml-py" tabindex="-1"><a class="header-anchor" href="#tips-change-yaml-py"><span>TIPS: change_yaml.py</span></a></h3><p>You can tweak YAML config by <strong>$(change_yaml.py xxx.yaml -a yyy=zzz)</strong></p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cd espnet/egs/an4/asr1; source path.sh; \</span></span>
<span class="line"><span style="color:#D4D4D4;">  ./run.sh  </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">ngpu </span><span style="color:#B5CEA8;">1</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">4</span><span style="color:#F44747;"> --</span><span style="color:#D4D4D4;">stop-stage </span><span style="color:#B5CEA8;">4</span><span style="color:#D4D4D4;"> \</span></span>
<span class="line"><span style="color:#F44747;">  --</span><span style="color:#D4D4D4;">train-config </span><span style="color:#F44747;">$</span><span style="color:#D4D4D4;">(change_yaml.py ./conf/train_mtlalpha1.0.yaml -a eunits=</span><span style="color:#B5CEA8;">100</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tips-tensorboard" tabindex="-1"><a class="header-anchor" href="#tips-tensorboard"><span>TIPS: tensorboard</span></a></h3><p>You can easily monitor effects of the config by tensorboard</p><h3 id="decoding-and-evaluation" tabindex="-1"><a class="header-anchor" href="#decoding-and-evaluation"><span>Decoding and evaluation</span></a></h3><p>decode config (<code>change_yaml.py</code> also works)</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cat espnet/egs/an4/asr1/conf/decode_ctcweight1.0.yaml</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="command-line-usage" tabindex="-1"><a class="header-anchor" href="#command-line-usage"><span>Command line usage</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">cd espnet/egs/an4/asr1; ./run.sh  </span><span style="color:#F44747;">--</span><span style="color:#D4D4D4;">stage </span><span style="color:#B5CEA8;">5</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="asr-result-as-data-json" tabindex="-1"><a class="header-anchor" href="#asr-result-as-data-json"><span>ASR result as <code>data.json</code></span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">head -n20 espnet/egs/an4/asr1/exp/train_nodev_pytorch_train_mtlalpha1.0/decode_test_decode_ctcweight1.0_lm_word100/data.json</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="recognize-speech-from-python" tabindex="-1"><a class="header-anchor" href="#recognize-speech-from-python"><span>Recognize speech from python</span></a></h3><p>Let&#39;s use ESPnet as a library and the trained model:</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#F44747;">!</span><span style="color:#D4D4D4;">ls espnet/egs/an4/asr1/exp/train_nodev_pytorch_train_mtlalpha1.0/results</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="recap-load-speech-from-data-json" tabindex="-1"><a class="header-anchor" href="#recap-load-speech-from-data-json"><span>recap: load speech from data.json</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> json</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> matplotlib.pyplot </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> plt</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> kaldiio</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># load 10-th speech/text in data.json</span></span>
<span class="line"><span style="color:#D4D4D4;">root = </span><span style="color:#CE9178;">&quot;espnet/egs/an4/asr1&quot;</span></span>
<span class="line"><span style="color:#C586C0;">with</span><span style="color:#DCDCAA;"> open</span><span style="color:#D4D4D4;">(root + </span><span style="color:#CE9178;">&quot;/dump/test/deltafalse/data.json&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;r&quot;</span><span style="color:#D4D4D4;">) </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> f:</span></span>
<span class="line"><span style="color:#D4D4D4;">  test_json = json.load(f)[</span><span style="color:#CE9178;">&quot;utts&quot;</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#D4D4D4;">  </span></span>
<span class="line"><span style="color:#D4D4D4;">key, info = </span><span style="color:#4EC9B0;">list</span><span style="color:#D4D4D4;">(test_json.items())[</span><span style="color:#B5CEA8;">10</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># plot the speech feature</span></span>
<span class="line"><span style="color:#D4D4D4;">fbank = kaldiio.load_mat(info[</span><span style="color:#CE9178;">&quot;input&quot;</span><span style="color:#D4D4D4;">][</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">][</span><span style="color:#CE9178;">&quot;feat&quot;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#D4D4D4;">plt.matshow(fbank.T[::-</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#D4D4D4;">plt.title(key + </span><span style="color:#CE9178;">&quot;: &quot;</span><span style="color:#D4D4D4;"> + info[</span><span style="color:#CE9178;">&quot;output&quot;</span><span style="color:#D4D4D4;">][</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">][</span><span style="color:#CE9178;">&quot;text&quot;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="load-model" tabindex="-1"><a class="header-anchor" href="#load-model"><span>load model</span></a></h4><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> json</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> torch</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> argparse</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> espnet.bin.asr_recog </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> get_parser</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> espnet.nets.pytorch_backend.e2e_asr </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> E2E</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">root = </span><span style="color:#CE9178;">&quot;espnet/egs/an4/asr1&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;">model_dir = root + </span><span style="color:#CE9178;">&quot;/exp/train_nodev_pytorch_train_mtlalpha1.0/results&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># load model</span></span>
<span class="line"><span style="color:#C586C0;">with</span><span style="color:#DCDCAA;"> open</span><span style="color:#D4D4D4;">(model_dir + </span><span style="color:#CE9178;">&quot;/model.json&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;r&quot;</span><span style="color:#D4D4D4;">) </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> f:</span></span>
<span class="line"><span style="color:#D4D4D4;">  idim, odim, conf = json.load(f)</span></span>
<span class="line"><span style="color:#D4D4D4;">model = E2E(idim, odim, argparse.Namespace(**conf))</span></span>
<span class="line"><span style="color:#D4D4D4;">model.load_state_dict(torch.load(model_dir + </span><span style="color:#CE9178;">&quot;/model.loss.best&quot;</span><span style="color:#D4D4D4;">))</span></span>
<span class="line"><span style="color:#D4D4D4;">model.cpu().eval()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># load token dict</span></span>
<span class="line"><span style="color:#C586C0;">with</span><span style="color:#DCDCAA;"> open</span><span style="color:#D4D4D4;">(root + </span><span style="color:#CE9178;">&quot;/data/lang_1char/train_nodev_units.txt&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;r&quot;</span><span style="color:#D4D4D4;">) </span><span style="color:#C586C0;">as</span><span style="color:#D4D4D4;"> f:</span></span>
<span class="line"><span style="color:#D4D4D4;">  token_list = [entry.split()[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">] </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> entry </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> f]</span></span>
<span class="line"><span style="color:#D4D4D4;">token_list.insert(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;&lt;blank&gt;&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">token_list.append(</span><span style="color:#CE9178;">&#39;&lt;eos&gt;&#39;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;"># recognize speech</span></span>
<span class="line"><span style="color:#D4D4D4;">parser = get_parser()</span></span>
<span class="line"><span style="color:#D4D4D4;">args = parser.parse_args([</span><span style="color:#CE9178;">&quot;--beam-size&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;2&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;--ctc-weight&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;1.0&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;--result-label&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;out.json&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;--model&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#D4D4D4;">result = model.recognize(fbank, args, token_list)</span></span>
<span class="line"><span style="color:#D4D4D4;">s = </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">.join(conf[</span><span style="color:#CE9178;">&quot;char_list&quot;</span><span style="color:#D4D4D4;">][y] </span><span style="color:#C586C0;">for</span><span style="color:#D4D4D4;"> y </span><span style="color:#C586C0;">in</span><span style="color:#D4D4D4;"> result[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">][</span><span style="color:#CE9178;">&quot;yseq&quot;</span><span style="color:#D4D4D4;">]).replace(</span><span style="color:#CE9178;">&quot;&lt;eos&gt;&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">).replace(</span><span style="color:#CE9178;">&quot;&lt;space&gt;&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot; &quot;</span><span style="color:#D4D4D4;">).replace(</span><span style="color:#CE9178;">&quot;&lt;blank&gt;&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&quot;&quot;</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;groundtruth:&quot;</span><span style="color:#D4D4D4;">, info[</span><span style="color:#CE9178;">&quot;output&quot;</span><span style="color:#D4D4D4;">][</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">][</span><span style="color:#CE9178;">&quot;text&quot;</span><span style="color:#D4D4D4;">])</span></span>
<span class="line"><span style="color:#DCDCAA;">print</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;prediction: &quot;</span><span style="color:#D4D4D4;">, s)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="shiki dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> os</span></span>
<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> kaldiio</span></span>
<span class="line"><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> IPython.display </span><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> Audio</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0;">try</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  d = os.getcwd()</span></span>
<span class="line"><span style="color:#D4D4D4;">  os.chdir(root)</span></span>
<span class="line"><span style="color:#D4D4D4;">  sr, wav = kaldiio.load_scp(</span><span style="color:#CE9178;">&quot;data/test/wav.scp&quot;</span><span style="color:#D4D4D4;">)[key]</span></span>
<span class="line"><span style="color:#C586C0;">finally</span><span style="color:#D4D4D4;">:</span></span>
<span class="line"><span style="color:#D4D4D4;">  os.chdir(d)</span></span>
<span class="line"><span style="color:#D4D4D4;">Audio(wav, </span><span style="color:#9CDCFE;">rate</span><span style="color:#D4D4D4;">=sr)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav" aria-label="page navigation"><p class="inner"><!----><span class="next"><a href="/notebook/espnet2/asr/asr_library.html" class="" aria-label="Speech Recognition (Library)"><!--[--><!--]--> Speech Recognition (Library) <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/notebook/assets/app-FOR18dDf.js" defer></script>
  </body>
</html>
